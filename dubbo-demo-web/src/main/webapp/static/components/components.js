var Horn=Horn||{debug_:false,fixed_:true,debug:function(b,a){if(Horn.debug_&&typeof console!="undefined"&&typeof console.log!="undefined"){console.log(b,a)}}};(function(h){var e=null,a=null;var g=0;var d=[],f=[];var j=[];var c={};h.apply=function(m,n,l){if(l){h.apply(m,l)}if(m&&n&&typeof n=="object"){for(var k in n){m[k]=n[k]}}return m};function b(){var k=$('<div style="display:none;position:fixed;z-index:100;"></div>');$("body").append(k);return k.css("position")=="fixed"}function i(){Horn.fixed_=b();Horn.debug("Horn.init","regist...");for(var l=0;l<f.length;l++){f[l]()}Horn.debug("Horn.init","ready...");while(d.length>0){var k=d.shift();k()}}h.apply(h,{id:function(k){if(!k){k="horn-comp-"}return k+(g++)},extend:(function(){var l=function(p){for(var n in p){this[n]=p[n]}};var k=Object.prototype.constructor;return function(r,o,q){if(typeof o=="object"){q=o;o=r;r=q.constructor!=k?q.constructor:function(){o.apply(this,arguments)}}var n=function(){},p,m=o.prototype;n.prototype=m;p=r.prototype=new n();p.constructor=r;r.superclass=m;if(m.constructor==k){m.constructor=o}r.override=function(s){h.override(r,s)};p.superclass=p.supr=(function(){return m});p.override=l;h.override(r,q);r.extend=function(s){return h.extend(r,s)};return r}})(),override:function(k,m){if(m){var l=k.prototype;h.apply(l,m)}},getCurrent:function(){if(e){return e}return $(document.body)},setCurrent:function(k){if(k){e=k}},createComp:function(l,k){if(typeof l=="function"){var m=new l(k);if(m instanceof h.Base){this.data(m);return m}}return null},data:function(l,k){if(!a){var m=this.getCurrent().find("form");if(m.length>0){a=m.first()}else{a=this.getCurrent()}}if($.type(l)=="object"){return a.data(l.getQID(),l)}else{if($.type(l)=="string"&&k){return a.data(l,k)}else{if($.type(l)=="string"&&!k){return a.data(l)}}}return a.data()},getQID:function(k,l){return k+"$"+(l||"_")},getComp:function(l,k){return this.data(this.getQID(l,k))},getCompByEl:function(k){return h.Base.getCompByEl(k)},register:function(k){f.push(k)},ready:function(k){d.push(k)},getCompById:function(k){return Horn.Base.getCompById(k)},submitHandler:function(m,l){var n=$.type(l)=="string"?this.getComp(l):l;if(n&&n instanceof h.Base){n.on("beforesubmit",m)}else{var k=h.getCurrent().find("form");k.each(function(o,q){var p=h.getCompByEl(q);if(!p){h.ready(function(){var r=h.getCompByEl(q);r.on("beforesubmit",m)})}else{p.on("beforesubmit",m)}})}},render:function(l,k){if(k.indexOf("Redirect:")>-1){window.location=k.substr(9)}else{$("#"+l).append(k)}},init:function(){i()},regUI:function(k,l){var m={};m.selector=k;m.type=l;j.push(m)},getUIReady:function(){return function(p,n){p=p||h.getCurrent();function m(s,r){var q=new Array;s.each(function(t,u){q.push(h.createComp(r,u))});if(r.DATANAME){h.data(r.DATANAME,n?q.concat(h.data(r.DATANAME)):q)}}for(var l=0;l<j.length;l++){var o=j[l];var k=p.find(o.selector);m(k,o.type)}Horn.enterToTab(p)}},enterToTab:function(k){var l=k.find("input:text:visible,input:password:visible");var m=function(p){var n=p.which;if(n==13){p.preventDefault();var o=l.index(this)+1;l.eq(o).focus()}};l.unbind("keydown",m);l.bind("keydown",m)},getDict:function(o,m){if(!c[o]){var n=$(".hc_checkboxdiv[ref_target="+o+"_s]");if(!n.get(0)){n=$(".hc_checkboxdiv[ref_target="+o+"_m]")}var l=n.find("li"),k={};l.each(function(q,p){p=$(p);var r=p.attr("title");var s=p.attr("value");if(!s){s=p.attr("key")}k[s]=r});c[o]=k}if(m){return Horn.Util.getDicts(o,m)}return c[o]}});h.register(h.getUIReady());$(document).ready(function(){i()});h.Base=function(){this.init.apply(this,arguments)};h.Base=h.extend(h.Base,{COMPONENT_CLASS:"Base",name:null,alias:null,el:null,params:{},REG_FUNCTION_NAME:[],regFuncs:function(l){this.REG_FUNCTION_NAME=this.REG_FUNCTION_NAME.concat(l);var o=this,n=this.el;if(this.REG_FUNCTION_NAME.length!=0){for(var m=0;m<this.REG_FUNCTION_NAME.length;m++){var k=this.REG_FUNCTION_NAME[m];if(typeof k=="string"){n[k]=function(){o[k].apply(o,arguments)}}else{n[k.src]=function(){o[k.tgt].apply(o,arguments)}}}}},regEvents:[],init:function(){this.el=$(arguments[0]);this.alias=this.alias||this.el.attr("alias");this.name=this.name||this.el.attr("name");if(this.el&&this.el.attr("paramcacheid")){if(Horn.paramCaches){this.params=Horn.paramCaches[this.el.attr("paramcacheid")];Horn.debug("Horn.UI["+this.COMPONENT_CLASS+"]:params",this.params)}}if((!this.name)&&this.params&&this.params.name&&!this.el.attr("nonamebyparams")){this.name=this.params.name}if((!this.alias)&&this.params&&this.params.alias){this.alias=this.params.alias}var k;if(this.params&&this.params.name1){k=this.params.name1}this.name=this.name||k||h.id();this.initCompEvnets();this.initStandardEvents();this.el.data("QID",this.getQID())},customEvents:"",initStandardEvents:function(){var l=this.getEventTarget&&this.getEventTarget();var k=this.params&&this.params.events;if(!k||!l||!l.length){return}var m=this;$.each(k,function(p,t){var n=t.event.toLowerCase();if(m.customEvents==""||m.customEvents.indexOf(n)==-1){var q=t["function"]||function(){};var s=null;if($.type(q)==="string"){var r=Horn.Util.getFunObj(q);q=r.fn;s=r.params}if(n.indexOf("on")==0&&$.type(q)==="function"){l.bind(n.substring(2),s,function(o){return q.call(m,o)})}}})},initCompEvnets:function(){this.events={};if(this.params&&this.params.events){var m=this.params.events;if(!$.isPlainObject(this.params.events)){return}for(var l in m){var k=Horn.Util.getFunObj(m[l]||"");this.on(l,k.fn)}}},getQID:function(){return h.getQID(this.name,this.alias)},events:null,on:function(l,k){if(!this.events[l]){this.events[l]=[]}this.events[l].push(k)},un:function(o,n){var m=this.events[o];if(!m){return}var k=false;for(var l=0;l<m.length;l++){var p=m[l];if(p==n){k=true}if(k&&l<m.length-1){m[l]=m[l+1]}}if(k){m.length-=1}},fire:function(o){var m=this.events[o];if(!m){return true}var k=[];$(arguments).each(function(q,p){if(q!=0){k.push(p)}});for(var l=0;l<m.length;l++){var n=m[l];if(n.apply(this,k)===false){return false}}return true}});$.extend(h.Base,{COMPMENTOBJECT:"COMPMENTOBJECT",getCompByEl:function(l){if(l instanceof Horn.Base){return l}var k=$(l);return k.comp()},getCompById:function(l){var k=$("#"+l);return k.comp()}});jQuery.fn.comp=function(){return Horn.data(this.data("QID"))}})(Horn);
var Horn=Horn||{};(function(H){Horn.Util={dictCache:{},apply:function(fn,scope){return(function(){return fn.apply(scope,arguments)})},getFunObj:function(event){var name=event;var params=[];if(event.indexOf("(")>-1){name=event.substring(0,event.indexOf("("));var ps=event.substring(event.indexOf("(")+1,event.indexOf(")")).split(",");for(var i=0;i<ps.length;i++){if(ps[i]){params.push(eval("("+ps[i]+")"))}}}return{fn:eval("(window."+name+")"),params:params}},stopPropagation:function(e){if(e&&e.stopPropagation){e.stopPropagation()}else{window.event.cancelBubble=true}},obj2Arr:function(obj){var arr=[];if($.type(obj)=="object"){for(var i in obj){if("string,number,boolean".indexOf($.type(obj[i]))>-1){arr.push({name:i,value:obj[i]})}}}return arr},arr2Obj:function(serValues){var values={};for(var i=0;i<serValues.length;i++){var name=serValues[i]["name"];var value=serValues[i]["value"];if(values[name]!==undefined&&values[name]!==""&&values[name]!==null){values[name]=values[name]+"";if(values[name]){values[name]=values[name]+","+value}else{values[name]=value}}else{values[name]=value}}return values},getValues:function(form){var serValues=$(form).serializeArray();var values=this.arr2Obj(serValues);return values},encode:function(object){return(function(){var _this=this;if(_this===null||_this===undefined){return""}if(_this instanceof Function||_this instanceof RegExp){return _this.toString()}if(_this instanceof String){return'"'+_this.toString()+'"'}if(_this instanceof Boolean||_this instanceof Number){return _this.toString()}if(_this instanceof Date){return _this.getTime()}if(_this instanceof Object||_this instanceof Array){var tempArr=new Array;if(_this instanceof Array){for(var i=0;i<_this.length;i++){tempArr.push(arguments.callee.call(_this[i]))}}else{for(var fieldname in _this){if(_this[fieldname]==null||_this[fieldname]==undefined){tempArr.push(arguments.callee.call(fieldname)+':""');continue}if(jQuery.type(_this[fieldname])=="function"||jQuery.type(_this[fieldname])=="regexp"){continue}if(_this[fieldname] instanceof Object){tempArr.push(arguments.callee.call(fieldname)+":"+arguments.callee.call(_this[fieldname]));continue}tempArr.push(arguments.callee.call(fieldname)+":"+arguments.callee.call(_this[fieldname]))}}var retString=tempArr.join("");if(_this instanceof Array){retString="["+tempArr.join(",")+"]"}else{retString="{"+tempArr.join(",")+"}"}return retString}else{return _this.toString()}}).call(object)},decode:function(string){return jQuery.parseJSON(string)},getParamValue:function(name){var value=location.search.match(new RegExp("[?&]"+name+"=([^&]*)(&?)","i"));return value?value[1]:value},loadBp:function(d,url,data,method,callback){function render(obj,bp){obj.children().remove();BigPipe.onArrive(bp);BigPipe.start();H.getUIReady()(obj);if(callback){callback.call(obj,obj,bp)}}data=data||{};var id=d;var dom=d;if(typeof d=="object"){dom=$(d);if(!dom.attr("id")){dom.attr("id",H.id())}id=dom.attr("id")}else{if(typeof d=="string"){dom=$("#"+id)}else{return}}url=(url.indexOf("?")===-1?url+"?":url+"&")+"pagelet="+id;if(url.indexOf("http")==-1){url=context_path+url}if(method=="get"){$.get(url,data,function(result){render(dom,eval("("+result+")"))})}else{$.post(url,data,function(result){render(dom,eval("("+result+")"))})}},serializeObject:function(param){function serArray(per,p){var arr=per[p];for(var i=0;i<arr.length;i++){var obj=arr[i];for(var prop in obj){if("string,boolean,number".indexOf(jQuery.type(obj[prop]))>-1){per[p+"["+i+"]."+prop]=obj[prop]}}}}if(param&&typeof param=="object"){for(var p in param){if(jQuery.type(param[p])=="array"){serArray(param,p);delete param[p]}}}return param},loadCss:function(url){BigPipe.onArrive({html:"",id:H.id(),css:[url],js:[],jsCode:""})},loadScript:function(url){BigPipe.onArrive({html:"",id:H.id(),css:[],js:[url],jsCode:""});BigPipe.start()},jump:function(url,reload){if(Horn.TabScreen){this.loadBp(Horn.getCurrent(),url,{},"get")}else{if(reload){url=(url.indexOf("?")===-1?url+"?":url+"&")+"_="+new Date().getTime()}window.location=url}},getDicts:function(dictName,keys){if(!Horn.Util.dictCache[dictName]){var dictDivs=$("div.hc_hide_div").children("div.hc_checkboxdiv");var dictDiv;dictDivs.each(function(i,obj){var ref_target_str=obj.getAttribute("ref_target");if(ref_target_str&&(ref_target_str.substring(0,ref_target_str.lastIndexOf("_"))==dictName)){dictDiv=$(obj);return false}});if(dictDiv){Horn.Util.dictCache[dictName]={};dictDiv.find("li").each(function(i,obj){var $obj=$(obj);Horn.Util.dictCache[dictName][$obj.attr("key")]=$obj.attr("title")})}else{return undefined}}if(keys){if(keys.indexOf(",")!=-1){var ks=keys.split(",");var values="";$.each(ks,function(i,key){if(key){values+=","+Horn.Util.dictCache[dictName][key]}});return values&&(values.indexOf(",")!=-1?values.substring(1):values)}else{return Horn.Util.dictCache[dictName][keys]}}else{return Horn.Util.dictCache[dictName]}}}})(Horn);String.prototype.toCharArray=function(){return this.split("")};String.prototype.repeat=function(b){var a=[];for(var c=0;c<b;c++){a.push(this)}return a.join("")};String.prototype.reverse=function(){return this.split("").reverse().join("")};String.prototype.isNumeric=function(){var b=parseFloat(this);if(isNaN(b)){return false}var a=this.length-b.toString().length;return b+"0".Repeat(a)==this};String.prototype.isInt=function(){if(this=="NaN"){return false}return this==parseInt(this).toString()};String.prototype.resetBlank=function(){return this.replace(/\s+/g," ")};String.prototype.ltrim=function(){return this.replace(/^\s+/g,"")};String.prototype.rtrim=function(){return this.replace(/\s+$/g,"")};String.prototype.trim=function(){return this.replace(/(^\s+)|(\s+$)/g,"")};String.prototype.getNum=function(){return this.replace(/[^\d]/g,"")};String.prototype.getEn=function(){return this.replace(/[^A-Za-z]/g,"")};String.prototype.getCn=function(){return this.replace(/[^\u4e00-\u9fa5\uf900-\ufa2d]/g,"")};String.prototype.getRealLength=function(){return this.replace(/[^x00-xff]/g,"--").length};String.prototype.left=function(a){return this.slice(0,a)};String.prototype.right=function(a){return this.slice(this.length-a)};String.prototype.HTMLEncode=function(){var c=this;var a=[/x26/g,/x3C/g,/x3E/g,/x20/g];var d=["&","<",">"," "];for(var b=0;b<a.length;b++){c=c.replace(a[b],d[b])}return c};String.prototype.ascW=function(){var a="";for(var b=0;b<this.length;b++){a+="&#"+this.charCodeAt(b)+";"}return a};String.prototype.firstUp=function(){return this.replace(/(^|\s+)\w/g,function(a){return a.toUpperCase()})};String.leftPad=function(c,b,a){if(!c){return c}if(b!==undefined&&b!==""&&a>0){c=c+"";b=b+"";while(c.length<a){c=b+c}}return c};if(!Array.indexOf){Array.prototype.indexOf=function(a){for(var b=0;b<this.length;b++){if(this[b]==a){return b}}return -1}};
var Horn=Horn||{};(function(a){Horn.Tip=new (function(){function b(d,c){d.click(function(){$(this).remove()});$(d).delay(2000).fadeOut(c)}this.init=function(c){var d=$("div.h_tips");var e=d.children("div").first();b(e,c?c:Horn.Tip.AUTO_HIDE_DELAY_SEC)};this.clear=function(){var c=$("div.h_tips");c.children("div:hidden").remove()};this.addTip=function(f,g){if(arguments.length==1){return this.addTip(Horn.Tip.TYPES.INFO,f)}var d="";if(f==Horn.Tip.TYPES.INFO){d=Horn.Tip.CSS.INFO}else{if(f==Horn.Tip.TYPES.WARNING){d=Horn.Tip.CSS.WARNING}else{if(f==Horn.Tip.TYPES.SUCCESS){d=Horn.Tip.CSS.SUCCESS}}}var h=$("div.h_tips");var c=false;if(h.length==0){c=true;h=$('<div class="h_tips"></div>');h.appendTo($(document.body))}if(g){var e="";if(c){if(Horn.fixed_){h.css("position","fixed")}}if(!c){}h.prepend($("<div class='"+d+"' "+e+">"+g+"</div>"))}};this.addTips=function(d,e){if(arguments.length==1){return this.addTips(Horn.Tip.TYPES.INFO,d)}if(e&&e.length){for(var c=0;c<e.length;c++){this.addTip(d,e[c])}}}});Horn.apply(Horn.Tip,{TYPES:{INFO:"C",WARNING:"W",SUCCESS:"S"},CSS:{INFO:"h_i",WARNING:"h_e",SUCCESS:"h_s"},AUTO_HIDE_DELAY_SEC:500,info:function(c,b){this.show(this.TYPES.INFO,c,b)},warn:function(c,b){this.show(this.TYPES.WARNING,c,b)},success:function(c,b){this.show(this.TYPES.SUCCESS,c,b)},show:function(c,d,b){this.clear();this.addTip(c,d);this.init(b)},shows:function(d,b){this.clear();if(d&&d.length){for(var c=0;c<d.length;c++){this.addTip(d[c].type,d[c].message)}}this.init(b)}});Horn.register(Horn.Tip.init)})(Horn);
Horn.emptyFn=function(){};(function(d){var b=["DOMMouseScroll","mousewheel"];if(d.event.fixHooks){for(var a=b.length;a;){d.event.fixHooks[b[--a]]=d.event.mouseHooks}}d.event.special.mousewheel={setup:function(){if(this.addEventListener){for(var e=b.length;e;){this.addEventListener(b[--e],c,false)}}else{this.onmousewheel=c}},teardown:function(){if(this.removeEventListener){for(var e=b.length;e;){this.removeEventListener(b[--e],c,false)}}else{this.onmousewheel=null}}};d.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}});function c(i){var h=i||window.event,g=[].slice.call(arguments,1),j=0,f=0,e=0;i=d.event.fix(h);i.type="mousewheel";if(h.wheelDelta){j=h.wheelDelta/120}if(h.detail){j=-h.detail/3}e=j;if(h.axis!==undefined&&h.axis===h.HORIZONTAL_AXIS){e=0;f=-1*j}if(h.wheelDeltaY!==undefined){e=h.wheelDeltaY/120}if(h.wheelDeltaX!==undefined){f=-1*h.wheelDeltaX/120}g.unshift(i,j,f,e);return(d.event.dispatch||d.event.handle).apply(this,g)}})(jQuery);Horn.Window=Horn.extend(Horn.Base,{COMPONENT_CLASS:"Window",defConf:{closeable:true,backClickCloseable:false,title:"窗口",width:500,minWidth:250,maxWidth:1000,height:500,minHeight:150,maxHeight:600,scroll:false},config:{},el:null,isShow:false,backdrop:null,wrapper:null,content:null,header:null,buttonBar:null,beforeClose:null,afterClose:null,beforeCloseFn:function(){return true},afterCloseFn:function(){},init:function(g){Horn.Window.superclass.init.apply(this,arguments);var c=$(g);this.el=c;var f=this;this.config={};this.config=$.extend(this.config,this.defConf);if(this.params){$.extend(this.config,this.params||{});if(isNaN(this.config.width)){this.config.width=this.defConf.width}else{if(typeof this.config.width=="string"){this.config.width=parseInt(this.config.width)}}if(this.config.width<this.defConf.minWidth){this.config.width=this.defConf.minWidth}if(isNaN(this.config.height)){this.config.height=this.defConf.height}else{if(typeof this.config.height=="string"){this.config.height=parseInt(this.config.height)}}if(this.config.height<this.defConf.minHeight){this.config.height=this.defConf.minHeight}if(typeof this.config.closeable=="string"){if(this.config.closeable=="true"){this.config.closeable=true}else{if(this.config.closeable=="false"){this.config.closeable=false}else{this.config.closeable=this.defConf.closeable}}}if(typeof this.config.closeable!="boolean"){this.config.closeable=this.defConf.closeable}if(this.config.beforeClose){this.beforeClose=this.config.beforeClose;var e=Horn.Util.getFunObj(this.beforeClose);if($.type(e.fn)=="function"){this.beforeCloseFn=e.fn}}if(this.config.afterClose){this.afterClose=this.config.afterClose;var b=Horn.Util.getFunObj(this.afterClose);if($.type(b.fn)=="function"){this.afterCloseFn=b.fn}}}this.content=c.children(".h_floatdiv-con");this.header=c.children(".h_floatdiv-title");this.buttonBar=c.children(".h_btndiv");if(this.buttonBar.length==0){this.buttonBar=undefined}if(this.buttonBar||true==this.config.scroll||"true"==this.config.scroll){this.config.scroll=true}this.backdrop=$("<div class='h_floatdiv-backdrop'></div>");var d=$("<div></div>");this.backdrop.css("width","100%").css("height","100%").css("z-index",Horn.Window.getNextZIndex());this.el.css("z-index",Horn.Window.getNextZIndex());d.append(this.backdrop);d.append(this.el);this.wrapper=d;$(document.body).append(d);d.hide();if(this.config.width){c.css("width",this.config.width+"px")}if(this.config.height){c.css("height",this.config.height+"px")}var a=this.header.children("a");if(this.config.closeable){a.bind("click",function(){f.hide()})}else{a.hide()}if(this.config.autoShow){this.show()}if(this.config.backClickCloseable){this.backdrop.click(function(){f.hide()})}Horn.getUIReady()(c,true);$(window).resize(function(){if(f.isShow){f.resize()}})},resize:function(){var g=$(window),b=this.el,e=0,a=0;var j=g.height();var f=g.width();var h=b.height();var d=b.width();e=j-h;a=f-d;if(e<38){e=38;h=j-38}if(a<38){a=38;d=f-38}var i=e/2+$(document).scrollTop();var c=a/2+$(document).scrollLeft();this.backdrop.css({top:$(document).scrollTop(),left:$(document).scrollLeft(),height:$(window).height(),width:$(window).width()});this.el.css({top:i,left:c,width:d,height:h})},show:function(a){if(Horn.Window.getOpen()<1){$("body").addClass("h-overflow-hidden");$("html").addClass("h-overflow-hidden")}Horn.Window.getNextOpen();this.resize();this.wrapper.show();this.el.show();this.isShow=true;if(this.config.scroll){var b=this.el.height()-this.header.outerHeight();if(this.buttonBar){b=b-this.buttonBar.outerHeight()}this.content.css({padding:0,margin:0,border:0,height:b}).addClass("h-overflow-auto")}else{this.el.mousewheel(function(){return false})}},hide:function(){if(this.beforeCloseFn.call()){if(Horn.Window.getPrevOpen()<1){$("body").removeClass("h-overflow-hidden");$("html").removeClass("h-overflow-hidden")}this.wrapper.hide();this.isShow=false;this.afterCloseFn.call()}},setTitle:function(a){this.el.children(".h_floatdiv-title").children("span").text(a);this.el.children(".h_floatdiv-title").children("span").attr("title",a)}});$.extend(Horn.Window,{DATANAME:"h_window",MAX_ZINDEX:100,OPENED:0,getNextOpen:function(){if(top.Horn&&top.Horn.Window){top.Horn.Window.OPENED++}else{Horn.Window.OPENED++;return Horn.Window.OPENED}},getPrevOpen:function(){if(top.Horn&&top.Horn.Window){top.Horn.Window.OPENED--;return top.Horn.Window.OPENED}else{Horn.Window.OPENED--;return Horn.Window.OPENED}},getOpen:function(){if(top.Horn&&top.Horn.Window){return top.Horn.Window.OPENED}else{return Horn.Window.OPENED}},getNextZIndex:function(){if(top.Horn&&top.Horn.Window){top.Horn.Window.MAX_ZINDEX++;return top.Horn.Window.MAX_ZINDEX}else{Horn.Window.MAX_ZINDEX++;return Horn.Window.MAX_ZINDEX}},get:function(b){var a=Horn.data(Horn.Window.DATANAME);var c=a[b];return c}});Horn.regUI("div.h_floatdiv",Horn.Window);
Horn.Util.Format={number:function(q,o){if(!o){return q}q=Number(q===null||typeof q=="boolean"?NaN:q);if(isNaN(q)){return""}var s=",",f=".",r=false,g=q<0;q=Math.abs(q);if(o.substr(o.length-2)=="/i"){o=o.substr(0,o.length-2);r=true;s=".";f=","}var b=o.indexOf(s)!=-1,a=(r?o.replace(/[^\d\,]/g,""):o.replace(/[^\d\.]/g,"")).split(f);if(1<a.length){q=q.toFixed(a[1].length)}else{if(2<a.length){throw ("NumberFormatException: invalid format, formats should have no more than 1 period: "+o)}else{q=q.toFixed(0)}}var p=q.toString();if(b){a=p.split(".");var l=a[0],e=[],h=l.length,d=Math.floor(h/3),c=l.length%3||3;for(var k=0;k<h;k+=c){if(k!=0){c=3}e[e.length]=l.substr(k,c);d-=1}p=e.join(s);if(a[1]){p+=f+a[1]}}return(g?"-":"")+o.replace(/[\d,?\.?]+/,p)}};Date.prototype.format=function(a){var d={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours()%12==0?12:this.getHours()%12,"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};var c={"0":"/u65e5","1":"/u4e00","2":"/u4e8c","3":"/u4e09","4":"/u56db","5":"/u4e94","6":"/u516d"};if(/(y+)/.test(a)){a=a.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))}for(var b in d){if(new RegExp("("+b+")").test(a)){a=a.replace(RegExp.$1,(RegExp.$1.length==1)?(d[b]):(("00"+d[b]).substr((""+d[b]).length)))}}return a};
Horn.Validate={REQUIRED:"required",CHECK:"check",CHECKSEP:";",init:function(b){var a=Horn.getCurrent();if(b){a=$(b)}else{a=a.find("form")}var c=this},isFormValidate:function(i,c){if(arguments.length==1){if(typeof arguments[0]=="boolean"){return this.isFormValidate(null,arguments[0])}}var g=Horn.Validate;var a=null;if($(this).length>0&&$(this).prop("tagName")){a=$(this)}else{if($(i).length>0&&$(i).prop("tagName")){a=$(i)}else{a=Horn.getCurrent().find("form")}}var d=a.find("div.h_formgridtitle").nextAll("ul.h_panel");var e=Horn.Field.findFieldsIn(d);var f=Horn.Field.findFieldsIn(a).not(e);var h=true;var b=[];setTimeout(function(){g.removeError(e)},100);f.each(function(j,k){var l=Horn.getCompByEl(k);l.validate();if(!l.isValid()){h=false;if(c){b.push(l.name)}}});if(h===false){return c?b:false}return h},validateAreaByGroup:function(d,c){var a=Horn.Field.findFieldsIn(d);var b=true;a.each(function(e,f){var g=Horn.getCompByEl(f);if(g&&g.inGroup(c)){g.validate();if(!g.isValid()){b=false}}});return b},onValid:function(f){var i=f.data[0];var a=f.data[1];var d=a.field;var c=d.prev("input[type='hidden']").size()>0?d.prev():d;var h=i.getRules.call(i,c);if(a instanceof Horn.Calendar||a instanceof Horn.CalendarGroup){if(h&&h.length>0&&d.attr("disabled")==undefined){var g=[];for(var b in h){if(h[b].name==Horn.Validate.REQUIRED){g.push(h[b])}}i.isValide.call(i,g,a,c.val())}else{i.removeError.call(i,a)}}else{if(h&&h.length>0&&d.attr("disabled")==undefined){i.isValide.call(i,h,a,c.val())}else{i.removeError.call(i,a)}}},regexEnum:{intege:"^-?[1-9]\\d*$",intege1:"^[1-9]\\d*$",intege2:"^-[1-9]\\d*$",num:"^([+-]?)\\d*\\.?\\d*$",num1:"^[1-9]\\d*|0$",num2:"^-[1-9]\\d*|0$",decmal:"^([+-]?)\\d*\\.\\d+$",decmal1:"^[1-9]\\d*.\\d*|0.\\d*[1-9]\\d*$",decmal2:"^-([1-9]\\d*.\\d*|0.\\d*[1-9]\\d*)$",decmal3:"^-?([1-9]\\d*.\\d*|0.\\d*[1-9]\\d*|0?.0+|0)$",decmal4:"^[1-9]\\d*.\\d*|0.\\d*[1-9]\\d*|0?.0+|0$",decmal5:"^(-([1-9]\\d*.\\d*|0.\\d*[1-9]\\d*))|0?.0+|0$",email:"^(\\w+((-\\w+)|(\\.\\w+))*\\@[A-Za-z0-9]+((\\.|-)[A-Za-z0-9]+)*\\.[A-Za-z0-9]+){0,1}$",color:"^[a-fA-F0-9]{6}$",url:"^http[s]?:\\/\\/([\\w-]+\\.)+[\\w-]+([\\w-./?%&=]*)?$",chinese:"^[\\u4E00-\\u9FA5\\uF900-\\uFA2D]+$",ascii:"^[\\x00-\\xFF]+$",zipcode:"^\\d{6}$",mobile:"^(13|15|18)[0-9]{9}$",ip4:"^(25[0-5]|2[0-4]\\d|[0-1]\\d{2}|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|[0-1]\\d{2}|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|[0-1]\\d{2}|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|[0-1]\\d{2}|[1-9]?\\d)$",notempty:"^\\S+$",picture:"(.*)\\.(jpg|bmp|gif|ico|pcx|jpeg|tif|png|raw|tga)$",rar:"(.*)\\.(rar|zip|7zip|tgz)$",date:"^\\d{4}\\d{1,2}\\d{1,2}$",qq:"[1-9][0-9]{4,11}",tel:"^(([0\\+]\\d{2,3}-)?(0\\d{2,3})-)?(\\d{7,8})(-(\\d{3,}))?$",username:"^\\w+$",letter:"^[A-Za-z]+$",letter_u:"^[A-Z]+$",letter_l:"^[a-z]+$",required:"^ *\\S[\\S ]*$",Message:"输入格式不正确",integeMessage:"输入的不是整数格式",intege1Message:"输入的不是正整数格式",intege2Message:"输入的不是负整数格式",requiredMessage:"当前输入不能为空",emailMessage:"邮件地址不正确",zipcodeMessage:"邮编输入格式不正确",dateMessage:"日期格式不正确",qqMessage:"QQ号码格式不正确",telMessage:"电话号码格式不正确",mobileMessage:"移动电话格式不正确",decmalMessage:"只能输入浮点数格式",decmal1Message:"只能输入正浮点数格式",decmal2Message:"只能输入负浮点数格式",decmal3Message:"只能输入浮点数格式",decmal4Message:"只能输入非负浮点数格式",decmal5Message:"只能输入非正浮点数格式",colorMessage:"只能输入颜色格式",urlMessage:"只能输入url格式",chineseMessage:"只能输入中文格式",asciiMessage:"只能输入ACSII字符格式",ip4Message:"只能输入ip4地址格式",pictureMessage:"只能输入图片格式",rarMessage:"只能输入压缩文件格式",numMessage:"只能输入数字格式",num1Message:"只能输入正数数字格式",num2Message:"只能输入负数数字格式",letterMessage:"只能输入字母格式",letter_uMessage:"只能输入大写字母格式",letter_lMessage:"只能输入小写字母格式",usernameMessage:"只能输入由数字、26个英文字母或者下划线组成的字符串"},funcEnum:{range:function(c,b,a){if(b!==undefined){if(c<b){return false}}if(a!==undefined){if(c>a){return false}}return true},rangeMessage:"{0}不在{1}-{2}范围内",compare:function(b,a){var c=Horn.Field.getField(a);if(c.val()!=b){return false}return true},compareMessage:"校验不匹配",length:function(c,b,a){if(c){if(c.length>a||c.length<b){return false}}return true},lengthMessage:"输入的长度{1}-{2}字符之间",past:function(e){var g=new Date();var c=g.getFullYear(),f=String.leftPad(g.getMonth()+1+"","0",2),b=String.leftPad(g.getDate()+"",2,"0");var a=c+""+f+""+b;if(e){if(e>=a){return false}}return true},pastMessage:"输入的日期{0}必须小于当前日期",future:function(e){var g=new Date();var c=g.getFullYear(),f=String.leftPad(g.getMonth()+1+"","0",2),b=String.leftPad(g.getDate()+"","0",2);var a=c+""+f+""+b;if(e){if(e<=a){return false}}return true},futureMessage:"输入的日期{0}必须大于当前日期",idcard:function(g){var b={11:"北京",12:"天津",13:"河北",14:"山西",15:"内蒙古",21:"辽宁",22:"吉林",23:"黑龙江",31:"上海",32:"江苏",33:"浙江",34:"安徽",35:"福建",36:"江西",37:"山东",41:"河南",42:"湖北",43:"湖南",44:"广东",45:"广西",46:"海南",50:"重庆",51:"四川",52:"贵州",53:"云南",54:"西藏",61:"陕西",62:"甘肃",63:"青海",64:"宁夏",65:"新疆",71:"台湾",81:"香港",82:"澳门",91:"国外"};function f(k){var j=k;if(j===""){return false}if(e(j)===false){return false}if(c(j)===false){return false}if(i(j)===false){return false}if(d(j)===false){return false}return true}function e(j){var k=/(^\d{15}$)|(^\d{17}(\d|X)$)/;if(k.test(j)===false){return false}return true}function c(k){var j=k.substr(0,2);if(b[j]==undefined){return false}return true}function i(j){var k=j.length;if(k=="15"){var r=/^(\d{6})(\d{2})(\d{2})(\d{2})(\d{3})$/;var m=j.match(r);var n=m[2];var l=m[3];var o=m[4];var p=new Date("19"+n+"/"+l+"/"+o);return a("19"+n,l,o,p)}if(k=="18"){var q=/^(\d{6})(\d{4})(\d{2})(\d{2})(\d{3})([0-9]|X)$/;var m=j.match(q);var n=m[2];var l=m[3];var o=m[4];var p=new Date(n+"/"+l+"/"+o);return a(n,l,o,p)}return false}function a(m,p,j,n){var k=new Date();var l=k.getFullYear();if(n.getFullYear()==m&&(n.getMonth()+1)==p&&n.getDate()==j){var o=l-m;if(o>=0&&o<=120){return true}return false}return false}function d(n){n=h(n);var k=n.length;if(k=="18"){var m=new Array(7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2);var j=new Array("1","0","X","9","8","7","6","5","4","3","2");var p=0,o,l;for(o=0;o<17;o++){p+=n.substr(o,1)*m[o]}l=j[p%11];if(l==n.substr(17,1)){return true}return false}return false}function h(l){if(l.length=="15"){var k=new Array(7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2);var j=new Array("1","0","X","9","8","7","6","5","4","3","2");var n=0,m;l=l.substr(0,6)+"19"+l.substr(6,l.length-6);for(m=0;m<17;m++){n+=l.substr(m,1)*k[m]}l+=j[n%11];return l}return l}return f(g)},idcardMessage:"{0}身份证格式不正确",Message:"{0}验证未通过"},applyString:function(a,b){return a.replace(/\{(\d+)\}/g,function(c,d){return b[d]})},isValide:function(j,h,i){var f=this;if(!j){Horn.Msg.alert("提示","fun.isValide 方法校验规则为空，请检查");return false}var e="string,array,function";if(e.indexOf($.type(j))==-1){Horn.Msg.alert("提示","fun.isValide 方法校验规则类型不正确，应为："+e);return false}var k=true;if((typeof j)=="string"){j=[{name:j,params:[i]}]}if((typeof j)=="function"){j=[{name:j,params:[i]}]}for(var g=0;g<j.length;g++){var l=j[g];var a=l.name;if(a===undefined||a===""){return"name 校验规则为空请检查"}if(a!="required"&&!i){continue}var b="";if(this.regexEnum[a]){k=(new RegExp(this.regexEnum[a],l.regexparam)).test(i);b=l.message||this.regexEnum[a+"Message"]||this.regexEnum.Message}else{if(this.funcEnum[a]){k=this.funcEnum[a].apply(h,l.params);b=l.message||this.funcEnum[a+"Message"]||this.funcEnum.Message}else{if($.type(window[a])=="function"){var c=l.params.slice(0);k=window[a].apply(h,c);b=k}else{Horn.Msg.alert("提示","错误的校验类型");return false}}}if(k!==true){var d=l.params;b=($.type(b)=="boolean"||!b)?b:f.applyString.apply(i,[b,d]);f.addError.call(f,h,b);return b}}if(h.isValid!=Horn.Field.prototype.isValid){setTimeout(function(){var m=h.isValid();if(m!==true){f.addError.call(f,h,m)}else{f.removeError.call(f,h,m)}},1);return}f.removeError.call(f,h);return k},getRules:function(c){var f=this;var d=Horn.Field.getField(c);var a=d.attr(this.CHECK);if(a){var b=a.split(this.CHECKSEP);var e=[];$.each(b,function(g,i){var h=f.getRule(d,i);if(h){e.push(h)}});return e}},getRule:function(field,rule){if(rule){var name=rule;var value=field.val();var params=[value];if(rule.indexOf("(")>-1){name=rule.substring(0,rule.indexOf("("));var ps=rule.substring(rule.indexOf("(")+1,rule.indexOf(")")).split(",");for(var i=0;i<ps.length;i++){if(ps[i]){params.push(eval("("+ps[i]+")"))}}}return{name:name,params:params}}return null},addError:function(d,a){var c=(typeof d=="string")?Horn.getComp(d):d;function b(e){if(e instanceof Horn.Field){e.showError(a)}else{Horn.Tip.addTip(a)}}if(!c){Horn.ready(function(){var e=(typeof d=="string")?Horn.getComp(d):d;b(e)})}else{b(c)}},removeError:function(a){a=(typeof a=="string")?Horn.getComp(a):a;$(a).each(function(b,c){try{c=Horn.getCompByEl(c)||c;c.removeError()}catch(d){if(window.console){window.console.warn("批量消除错误失败"+c)}}})}};
Horn.Form=Horn.extend(Horn.Base,{COMPONENT_CLASS:"Form",form:null,ajax:false,ajaxCallback:false,onSuccessObj:null,baseParams:null,init:function(){Horn.Form.superclass.init.apply(this,arguments);this.form=this.el;var i=this.form.attr("ajax");var j=this;this.baseParams={};this.beforeSubmit=this.params.beforeSubmit;var b=this;$.each(this.params.events||[],function(e,l){b[l.event]=l["function"]});if(this.beforeSubmit){var c=Horn.Util.getFunObj(this.beforeSubmit);if(c&&$.type(c.fn)=="function"){this.on("beforesubmit",c.fn)}}var a=function(){return j.fire("beforesubmit")};var h=j.toAjaxForm;j.toAjaxForm=function(){j.el.unbind("submit",a);h.call(j)};if(!i){j.el.submit(a)}else{try{var k=Horn.Util.decode(i);if($.isPlainObject(k)){var g=k.onSuccess;if(g){var f=Horn.Util.getFunObj(g);if(f&&$.type(f.fn)=="function"){this.on("ajaxsuccess",f.fn)}}}}catch(d){}j.toAjaxForm()}j.on("beforesubmit",j.isValid);this.form.bind("reset",function(){j.reset(false);return false});if(j.el.find(":file").get(0)){j.el.attr("enctype","multipart/form-data")}},customEvents:"beforesubmit",getEventTarget:function(){return this.el},toAjaxForm:function(){var a=this;if(this.ajax===true){return}this.ajax=true;this.el.submit(function(){if(a.fire("beforesubmit")==true){a.doPost()}return false})},setBaseParams:function(a){this.baseParams=a},doPost:function(){var values=this.getValues();var url=this.form.attr("action");Horn.apply(values,this.baseParams);url=(url.indexOf("?")===-1?url+"?":url+"&")+"pagelet="+(values.pagelet||new Date().getTime());function onAjaxComplate(result){var data=eval("("+result+")");BigPipe.onArrive(data);BigPipe.start();Horn.init()}$.post(url,values,onAjaxComplate)},submit:function(){this.form.submit()},reset:function(a){if(!a===false){this.form.get(0).reset()}Horn.Field.findFieldCompsIn(this.form).each(function(){if($.isFunction(this.reset)){this.reset()}});var b=this.form.find("div.hc_label[name]");b.each(function(c,e){var f=$(e);var d=Horn.getCompByEl(f);d.setValue("")})},clearValue:function(){Horn.Field.findFieldCompsIn(this.form).each(function(){this.clearValue()});var a=this.form.find("div.hc_label[name]");a.each(function(b,d){var e=$(d);var c=Horn.getCompByEl(e);c.setValue("")})},getValues:function(){var a=this.form.serializeArray();return Horn.Util.arr2Obj(a)},getFieldComps:function(){return Horn.Field.findFieldCompsIn(this.el)},setValues:function(c,d,a){var b=c;if(!d){d=""}if($.isArray(c)){b=Horn.Util.arr2Obj(c)}this.getFieldComps().each(function(f,j){var g=j.mutiName();if(g){var k={};var h=0;$(g).each(function(i,l){k[l]=b[l.replace(new RegExp("^"+d+""),"")];if(k[l]){h++}});if(h!=0){j.setValue(k||"")}else{if(!(a==false)){j.setValue("")}}}else{var k=b[j.name.replace(new RegExp("^"+d+""),"")];if(k){j.setValue(k)}else{if(!(a==false)){j.setValue("")}}}});var e=this.form.find("div.hc_label[name|hiddenName]");e.each(function(f,h){var j=$(h);var g=Horn.getCompByEl(j);var i=b[g.name.replace(new RegExp("^"+d+""),"")];if(i){g.setValue(i)}else{if(!(a==false)){g.setValue("")}}})},isValid:function(){return Horn.Validate.isFormValidate(this.form)},serializeArray:function(){return this.form.serializeArray()},serialize:function(){return this.form.serialize()},findField:function(b,f){var c=f||"";var e=null;var d=this.el;if(jQuery.type(b)=="string"){var a=Horn.Field.getSelector(b,c);e=$(a,d);if(!c){e=e.not(":disabled")}}else{e=$(b,d)}return e}});$.extend(Horn.Form,{DATANAME:"h_form",get:function(b){var a=Horn.data(Horn.Form.DATANAME);var c=a[0];return c}});Horn.regUI("form",Horn.Form);
Horn.Field=Horn.extend(Horn.Base,{COMPONENT_CLASS:"Field",field:null,hidden:null,checkGroup:null,defValue:"",defHiddenValue:"",init:function(d){Horn.Field.superclass.init.apply(this,arguments);if(this.field==undefined){this.hidden=this.el.children("input[type='hidden']");if(this.hidden.length){this.field=this.hidden.next("input[type]")}else{this.field=this.el.children("input[type]");if(this.field.length==0){this.field=this.el.children("textarea")}}}this.name=this.field.attr("name")||this.name;this.checkGroup={};var b=this,a=this.field.attr("group");if(a){var c=a.split(";");$(c).each(function(e,f){b.checkGroup[f]=true})}this.initEvents();this.defHiddenValue="";this.defValue="";if(this.hidden.length>0){this.defHiddenValue=this.params.defValue||this.hidden.val()||""}if(this.field.length>0){this.defValue=this.params.defValue||this.field.val()||""}},getEventTarget:function(){this.hidden=this.el.children("input[type='hidden']");if(this.hidden.length){this.field=this.hidden.next("input[type]")}else{this.field=this.el.children("input[type]");if(this.field.length==0){this.field=this.el.children("textarea")}}return this.field},checkRegx:null,initEvents:function(){var a=this;a.checkRegx=[];var b=this.field.attr("checkstr");if(b){a.checkRegx=b.split(";")}this.field.blur(function(){Horn.Validate.onValid({data:[Horn.Validate,a]})})},validate:function(){if(!this.skipValid){this.field.blur()}},addGroup:function(a){this.checkGroup[a]=true},removeGroup:function(a){this.checkGroup[a]=false},inGroup:function(a){return !!this.checkGroup[a]},get:function(){if(this.hidden&&this.hidden.length){return this.hidden}return this.field},addRule:function(f){var c=this.get();var b=c.attr(Horn.Validate.CHECK);if(b){if(b.indexOf(f)>-1){return}b+=Horn.Validate.CHECKSEP+f}else{b=f}c.attr(Horn.Validate.CHECK,b);if(f&&f.indexOf(Horn.Validate.REQUIRED)>-1){var a=this.el.parent();var d=$("span",a);var e=$("b.hc_red",d);if(!e.length){e=$("<b>",{"class":"hc_red",html:"*"});d.prepend(e)}else{e.html("*")}}this.removeError()},removeRule:function(d){var b=this.get();var a=b.attr(Horn.Validate.CHECK);if(a&&a.indexOf(d)>-1){var c=a.split(Horn.Validate.CHECKSEP);c=$.grep(c,function(f,e){return f&&f!=d});b.attr(Horn.Validate.CHECK,c.join(";"));this.removeError();this.setNotRequired()}},skipValid:false,show:function(){this.skipValid=false;var a=this.el.parent();if(a.css("display")=="none"){a.css("display","block")}if(a.css("visibility")=="hidden"){a.css("visibility","visible")}Horn.enterToTab(Horn.getCurrent())},hide:function(b){this.skipValid=true;b=b||"display";var a=this.el.parent();if(b=="display"){a.css("display","none")}else{a.css("visibility","hidden")}if(this.err){this.removeError()}Horn.enterToTab(Horn.getCurrent())},setLabel:function(b){var a=this.el.parent();var c=$("span",a);var d=$("b.hc_red",c);c.attr("title",b);if(!d.length){c.html(b)}else{c.html('<b class="hc_red">*</b>'+b)}},getLabel:function(){var a=this.el.parent();var b=$("span",a);return b.attr("title")},setRequired:function(a){if(a===false){this.setNotRequired();return}this.addRule(Horn.Validate.REQUIRED)},setNotRequired:function(){var a=this.el.parent();var b=$("span",a);var c=$("b.hc_red",b);this.removeRule(Horn.Validate.REQUIRED);c.html("")},setEnable:function(b){var a=this.field;var c=a.next("input[type='text']");if(b){a.removeAttr("disabled");c.removeAttr("disabled")}else{a.attr("disabled","disabled");c.attr("disabled","disabled")}Horn.enterToTab(Horn.getCurrent())},setDisabled:function(a){if(a===false){this.setEnable(true);this.disabled=false}else{this.setEnable(false);this.disabled=true}},setReadonly:function(a){if(a===false){this.field.removeAttr("readonly");this.readonly=false}else{this.field.attr("readonly","readonly");this.readonly=true}},setValue:function(a){this.field.val(a);this.hidden.val(a)},getValue:function(){var a=this.get();return a.val()},reset:function(a){var b="";if(this.hidden&&this.hidden.length>0){b=a?"":this.defHiddenValue}else{b=a?"":this.defValue}this.setValue(b)},clearValue:function(){this.setValue("")},bind:function(c,d,b){var a=this.get();if($.type(d)=="function"){a.bind(c,d)}else{a.bind(c,d,b)}},isValid:function(){return !this.err},err:false,msgDiv:null,showError:function(a){var b=this.field;a=$.type(a)=="boolean"?"校验错误":a;if(!this.msgDiv){this.msgDiv=$('<span class="hc_verification" style="display:none;"></span>');this.el.after(this.msgDiv)}var c=this.msgDiv;c.html(a);c.css("display","none");b.addClass("hc_ver-bd");b.hover(function(){if(c){c.css("display","inline")}},function(){if(c){c.css("display","none")}});this.err=true},removeError:function(){this.field.removeClass("hc_ver-bd");this.err=false;var a=this.msgDiv;if(a){a.remove()}delete this.msgDiv},mutiName:function(){return false}});$.extend(Horn.Field,{get:function(a,b){if(jQuery.type(a)!="string"){var c=$(a);a=c.attr("name");b=c.attr("alias");if(!a){var d=c.prev("input[type='hidden'][name]");a=d.attr("name");b=d.attr("alias")}}var e=Horn.getComp(a,b);return e},addRule:function(a,d,b){var c=this.get(a,b);c.addRule(d)},removeRule:function(a,d,b){var c=this.get(a,b);c.removeRule(d)},show:function(a,b){var c=this.get(a,b);c.show()},hide:function(a,b){var c=this.get(a,b);c.hide("display")},hidden:function(a,b){var c=this.get(a,b);c.hide("visibility")},setRequired:function(a,b){var c=this.get(a,b);c.setRequired()},setNotRequired:function(a,b){var c=this.get(a,b);c.setNotRequired()},setEnable:function(b,a,c){var d=this.get(b,c);d.setEnable(a)},setReadonly:function(a,d,b){var c=this.get(a,b);c.setReadonly(d)},setLabel:function(b,a,c){var d=this.get(b,c);d.setLabel(a)},getLabel:function(a,b){var c=this.get(a,b);return c.getLabel()},setValue:function(a,c,b){var d=this.get(a,b);if(d){d.setValue(c)}else{this.getField(a,b).val(c)}},getValue:function(a,b,c){var d=this.get(a,b);if(d){return d.getValue()}else{return this.getField(a,b,c).val()}},reset:function(a,b){var c=this.get(a,b);if(c){c.reset()}else{this.getField(a,b).each(function(){this.reset()})}},clearValue:function(a,b){var c=this.get(a,b);if(c){c.clearValue()}else{this.getField(a,b).val("")}},bind:function(a,b,d,e,c){var f=this.get(a,b);f.bind(d,e,c)},getSelector:function(b,c){var a="";if(b){a+="[name='"+b+"']"}if(c){a+="[alias='"+c+"']"}return"input"+a+",textarea"+a},getField:function(b,c,d){var f=Horn.getCurrent();c=c||"";var e=null;if(!d){d=f.find("form");if(jQuery.type(b)=="string"){var a=Horn.Field.getSelector(b,c);e=$(a,d)||$(a);if(!c){e=e.not(":disabled")}}else{e=$(b,d)}return e}else{return d.findField(b,c)}},findFieldCompsIn:function(b){var a=[];this.findFieldsIn(b).each(function(c,d){var e=Horn.getCompByEl($(d));if(e){a.push(e)}});return $(a)},findFieldsIn:function(a){return $(a).find(this.TYPES.join(","))},findInputComp:function(a){return $(a).parents(this.TYPES.join(",")).first().comp()},TYPES:[],regFieldType:function(a,b){Horn.regUI(a,b);this.TYPES.push(a)}});Horn.Field.regFieldType("div.hc_textfield",Horn.Field);Horn.Field.regFieldType("div.hc_textarea",Horn.Field);
Horn.HiddenField=Horn.extend(Horn.Field,{COMPONENT_CLASS:"HiddenField",init:function(){Horn.HiddenField.superclass.init.apply(this,arguments);this.field=this.el;this.name=this.field.attr("name");this.alias=this.field.attr("alias")||"";this.defValue=(this.params.defValue!=undefined)?this.params.defValue:this.field.val()},isValid:function(){return true},showError:function(){},reset:function(a){if(a){this.field.val("")}else{this.field.val(this.defValue)}},removeError:function(){}});Horn.Field.regFieldType("input.hc_hiddenfield",Horn.HiddenField);
Horn.PasswordGroup=Horn.extend(Horn.Field,{COMPONENT_CLASS:"PasswordGroup",field1:null,field2:null,name1:null,name2:null,defValue1:"",defValue2:"",init:function(b){var a=$(b).find("input");this.field1=$(a[0]);this.field2=$(a[1]);this.name1=this.field1.attr("name");this.name2=this.field2.attr("name");Horn.PasswordGroup.superclass.init.apply(this,arguments);if(this.field1){this.defValue1=(this.params.defValue!=undefined)?this.params.defValue:this.field1.val();this.defValue2=(this.params.defValue!=undefined)?this.params.defValue:this.field2.val()}},initEvents:function(){var a=this;this.field2.bind("blur",function(){Horn.Validate.onValid({data:[Horn.Validate,a]});if(a.isValid()){var b=a.field1.val();if(a.field2.val()!=b){a.showError("校验不匹配！")}else{a.removeError()}}});this.field1.blur(function(){Horn.Validate.onValid({data:[Horn.Validate,a]});if(a.isValid()){var b=a.field2.val();if(a.field1.val()!=b&&b){a.showError("校验不匹配！")}else{a.removeError()}}})},validate:function(){this.field1.blur();this.field2.blur()},setValue:function(a){this.field1.val(a);this.field2.val(a);this.field1.blur();this.field2.blur()},getValue:function(){return this.field1.val()},reset:function(a){var b=a?"":this.defValue1;this.setValue(b)},clearValue:function(){this.setValue("")},setEnable:function(a){var b=this;if(a){this.field1.removeAttr("disabled");this.field2.removeAttr("disabled");this.field1.blur();this.field2.blur()}else{this.field1.attr("disabled","disabled");this.field2.attr("disabled","disabled");b.removeError()}}});Horn.Field.regFieldType("div.hc_passwordgroup",Horn.PasswordGroup);
Horn.Password=Horn.extend(Horn.Field,{COMPONENT_CLASS:"Password",init:function(a){Horn.Password.superclass.init.apply(this,arguments)}});Horn.Field.regFieldType("div.hc_password",Horn.Password);
Horn.Panel=Horn.extend(Horn.Base,{COMPONENT_CLASS:"Panel",init:function(){Horn.Panel.superclass.init.apply(this,arguments);var a=this.el.parent(".hc_extendsearch");var b=this;if(a){a.find(".hc_btn-es-div").each(function(){var c=$(this);if(c.hasClass("hc_minus")){b.closebar=c;c.click(function(){b.hide();b.disable();b.expanedbar.show();c.hide()})}else{b.expanedbar=c;c.click(function(){b.show();b.enable();b.closebar.show();c.hide()})}})}},show:function(){this.el.show()},hide:function(){this.el.hide()},enable:function(){Horn.Field.findFieldCompsIn(this.el).each(function(a,b){this.setDisabled(false)});this.el.find("button,select").removeAttr("disabled")},disable:function(){Horn.Field.findFieldCompsIn(this.el).each(function(a,b){this.setDisabled(true)});this.el.find("button,select").removeAttr("disabled");this.el.find("button,select").attr("disabled","disabled")}});Horn.regUI("ul.h_panel",Horn.Panel);
Horn.RadioGroup=Horn.extend(Horn.Field,{COMPONENT_CLASS:"RadioGroup",radios:null,name:null,alias:null,checkRegx:[],init:function(){Horn.RadioGroup.superclass.init.apply(this,arguments);this.radios=this.el.find("input[type='radio']");this.name=this.el.attr("name");this.alias=this.el.attr("alias")||"";if(this.params.check&&this.params.check.indexOf("required")>-1){this.checkRegx=[Horn.Validate.REQUIRED]}if(this.params.value){this.setValue(this.params.value)}if(this.params.disabled){this.setDisabled(true)}this.defValue=this.params.defValue||this.params.value||""},getEventTarget:function(){return this.el.find("input[type='radio']")},getValue:function(){return this.radios.filter(":checked").val()||""},setValue:function(c){var b=this;var a=this.radios;if(c==""){this.radios.removeAttr("checked")}else{if(this.radios.filter('[value="'+c+'"]').length>0){if(this.radios.filter('[value="'+c+'"]').attr("disabled")){setTimeout(function(){a.attr("disabled","disabled");a.removeAttr("checked");a.filter('[value="'+c+'"]').attr("checked","checked")},10)}else{a.removeAttr("checked");a.each(function(d,e){if($(e).val()==c){$(e).attr("checked","checked")}})}}}},clearValue:function(){this.setValue("")},setEnable:function(a){var b=this;this.radios.each(function(c,d){if(a===false){$(this).attr("disabled","disabled")}else{$(this).removeAttr("disabled")}})},setDisabled:function(a){var b=this;if(a===true){b.disabled=true}else{if(a===false){b.disabled=false}}this.radios.each(function(c,d){if(a===true){$(this).attr("disabled","disabled")}else{$(this).removeAttr("disabled")}})},validate:function(){this.isValid()},isValid:function(){var a=true;var d=this;var b=this.name;if(d.disabled==true){return true}if(this.checkRegx.length>0){var c=Horn.getComp(b).getValue();if(c==""){a=false;this.addMsg(d);$("input[name="+b+"]").click(function(){d.el.unbind("mouseover");d.el.unbind("mouseout");d.el.removeClass();d.el.addClass("hc_radio-group");$("#radio_"+b).remove()})}else{this.removeMsg(d)}}return a},addMsg:function(e){var c=window.navigator.userAgent.toLowerCase();var a=$.browser.msie&&/msie 7\.0/i.test(c);var d=true;if($.browser.msie){if(document.documentMode&&document.documentMode>=8){d=true}else{if(document.documentMode&&document.documentMode<8){d=false}}}var b=e.name;e.el.removeClass();e.el.addClass("hc_radio-group hc_ver-bd");e.el.mouseover(function(){var g=$(this).css("height");g=g.replace("px","");var i=parseInt(g)+3;if(!d||a){i=0}var f='<span class="hc_verification" id="radio_'+b+'" style="margin-top:'+i+'px;">当前的单选框不能为空</span>';var h=$("#radio_"+b);if(h.length==0){e.el.after(f)}else{$("#radio_"+b).css("display","inline")}});e.el.mouseout(function(){$("#radio_"+b).css("display","none")})},removeMsg:function(b){var a=b.name;b.el.unbind("mouseover");b.el.unbind("mouseout");b.el.removeClass();b.el.addClass("hc_radio-group");$("#radio_"+a).remove()},reset:function(){this.setValue(this.defValue)},setRequired:function(a){if(a===false){this.setNotRequired();return}else{if(a===true||a===undefined){this.addRule(Horn.Validate.REQUIRED)}}},setNotRequired:function(){this.removeRule(Horn.Validate.REQUIRED)},removeRule:function(e){var c=this;c.el.removeClass("hc_ver-bd");this.checkRegx=[];var a=this.el.parent();var b=$("span",a);var d=$("b.hc_red",b);d.html("");c.err=false;this.removeMsg(this)},addRule:function(e){var c=this;if(e&&e.indexOf(Horn.Validate.REQUIRED)>-1){c.err=true;this.checkRegx=[Horn.Validate.REQUIRED];var a=c.el.parent();var b=$("span",a);var d=$("b.hc_red",b);if(!d.length){d=$("<b>",{"class":"hc_red",html:"*"});b.prepend(d)}else{d.html("*")}}else{return}}});Horn.Field.regFieldType("div.hc_radio-group",Horn.RadioGroup);
Horn.Select=Horn.extend(Horn.Field,{COMPONENT_CLASS:"Select",delimiter:"",bodyclicktype:"click.select",select:null,field:null,hidden:null,listEl:null,multipleline:false,name:null,alias:null,showLabel:true,hasHeadItem:false,init:function(c){Horn.Select.superclass.init.apply(this,arguments);var e=this;this.select=this.el;this.hidden=this.select.children("input[type='hidden']");this.field=this.hidden.next();this.name=this.hidden.attr("name");this.alias=this.hidden.attr("alias")||"";if(this.field.attr("delimiter")!=undefined){this.delimiter=this.field.attr("delimiter")}var a=this.params.headItem;if(a){this.hasHeadItem=true}var d=this.field.attr("ref");this.listEl=d?Horn.getCurrent().find("div.hc_hide_div").children("div.hc_checkboxdiv[ref_target='"+d+"']"):this.field.next("div.hc_checkboxdiv");if(!this.listEl.get(0)){this.listEl=$("div.hc_hide_div").children("div.hc_checkboxdiv[ref_target='"+d+"']")}this.listEl=this.listEl.first();this.multipleline=this.params.multiple;if(String(this.params.showLabel)=="false"){this.showLabel=false}this.handerHeadItem();this.field.bind({focus:Horn.Util.apply(e.onFocus,e),keydown:Horn.Util.apply(e.onKeyDown,e),keypress:Horn.Util.apply(e.onKeyPress,e),keyup:Horn.Util.apply(e.onKeyUp,e)});var b=this.params.value||this.hidden.val();if(b===""){this.setValue("",undefined,true)}else{this.setValue(b)}if(this.params.readonly){this.setReadonly(true)}if(this.params.disabled){this.setDisabled(true)}if(!this.multipleline){this.field.attr("readonly","true");this.readonly=true}this.DICT=(function(g){if(g.params.items){var f={};$(g.params.items).each(function(h,j){f[j.label]=j.value});return f}else{return Horn.getDict(g.params.dictName)}})(this)},setDisabled:function(a){if(a===false){this.setEnable(true);this.disabled=false}else{this.setEnable(false);this.disabled=true}},setReadonly:function(a){if(!this.multipleline){this.field.attr("readonly","true");this.readonly=true}else{if(a===false){this.field.removeAttr("readonly");this.readonly=false}else{this.field.attr("readonly","true");this.readonly=true}}},createHeadItem:function(){var d=this.params.headItem;var a=this.params.multiple;if(this.hasHeadItem&&!a){var b=d.label?d.label:"";var f=d.pLabel?d.pLabel:"";var e=d.value?d.value:"";var c="<li key='"+b+"' pkey='"+f+"' title='"+e+"' headItem='"+this.name+"' ><label>"+e+"</label></li>";this.listEl.children("ul").prepend(c)}},handerHeadItem:function(){var e=this.name;var a=this.listEl.children("ul");if(a.length>0){if(this.hasHeadItem){var d=false;var c=a.children("li[headItem]");if(c.length>0){c.each(function(f,h){var g=$(h).attr("headItem");if(e!=g){$(h).remove()}else{d=true}});if(d){return}else{this.createHeadItem()}}else{this.createHeadItem()}}else{var b=a.children("li[headItem]");if(b.length>0){b.remove()}}}},setValue:function(j,d,b){this.handerHeadItem();var e=this.hidden;var k=e.val();var h=this.field;if(j===undefined||j===null){h.val("");e.val("");return false}if(j==""){e.val("")}if($.type(j)=="string"){j={key:j}}var g=this.listEl.children("ul");if(this.listEl.length>0){if(this.multipleline){h.val(j.key);e.val(j.key)}else{if(!j.text){var l=g.children("li[key='"+j.key+"']");j.text=jQuery.trim(l.text());if(!this.showLabel){var i=l.find("span");j.text=j.text.replace(i.text(),"")}}if(j.text!=""){h.val(j.text);e.val(j.key)}else{if(j.key==""){h.val("")}else{return}}}if(d&&k!=j.key){h.trigger("change",[j.key])}}if(this.multipleline){var c=this.field.val();var a=[];var f=this;if(c!=""&&c!=null){$("input[type='checkbox']",this.listEl).each(function(o,t){var n=$(t).parent().parent("li[key]");var r=n.attr("key");var s=c.split(f.delimiter);var m=s.length;for(var q=0;q<m;q++){var p=s[q];if(r==p){a.push(p)}}});this.hidden.val(a.join(this.delimiter))}}},getValue:function(b){this.handerHeadItem();if(b){var a=this;var f=this.hidden.val();var e=function(g){return a.DICT[g]||null};if(this.multipleline){var d=f.split(this.delimiter);var c=[];$(d).each(function(g,h){var j=e(h);if(j){c.push(j)}});return c.join(this.delimiter)}else{return e(f)}}return this.hidden.val()},onFocus:function(c){var b=$(c.currentTarget);var a=this.listEl;if(a.length>0){this.showList(b,a)}else{var d=this.field.attr("ref");this.listEl=d?this.el.parents(".h_floatdiv").find("div.hc_hide_div").children("div.hc_checkboxdiv[ref_target='"+d+"']"):this.field.next("div.hc_checkboxdiv");if(this.listEl.length>0){this.showList(b,this.listEl)}this.multipleline=this.listEl.attr("multiple_line")=="true"}},onKeyDown:function(g){var k=g.keyCode;var f=this.listEl;var h=f.children("ul");var l=h.children("li");var j=h.children("li.h_cur");var a=f.get(0);var i=h.children("li").last().get(0);if(g.ctrlKey&&k===65&&this.multipleline){var d=h.find("input:not(:checked)");if(d.length==0){l.removeClass("h_cur");d=l.children("label").children("input");d.each(function(m,e){e.checked=false});this.setValue("")}else{d.each(function(m,e){e.checked=true;$(e).parent("label").parent("li").addClass("h_cur")});d.last().parent("label").parent("li").triggerHandler("click.li")}Horn.Util.stopPropagation(g);return false}else{if(k===38){if(!this.multipleline){var b=j.prev();if(b.length){a.scrollTop=b.get(0).offsetTop+(a.scrollHeight-a.clientHeight)-i.offsetTop;j.removeClass("h_cur");b.addClass("h_cur")}}}else{if(k===40){if(!this.multipleline){var c=j.next();if(c.length){a.scrollTop=c.get(0).offsetTop+(a.scrollHeight-a.clientHeight)-i.offsetTop;j.removeClass("h_cur");c.addClass("h_cur")}}}else{if(k===46||k===8){if(!this.multipleline){this.setValue("")}}else{if(k===9){this.hideList(this.field,f)}else{if(k===13||k===32){if(!this.multipleline){j.trigger("click.li");Horn.Util.stopPropagation(g)}return false}else{}}}}}}},onKeyPress:function(f){var m=f.keyCode;var l=String.fromCharCode(m);var c="";var d=this.listEl;var g=d.children("ul");var k=g.children("li");if(m>=65&&m<=90){c=l.toLowerCase()}else{c=l.toUpperCase()}var b=this.selectLi(l,c);var j=k.last().get(0);var a=d.get(0);if(m===38){}else{if(m===46||m===8){}else{if(m===40){}else{if(m===13){}else{if(this.multipleline){var i=this.getValue();if(i.indexOf(l)==-1){if(b){var h=b.children("label").children("input");if(!h.get(0).checked){h.get(0).checked=true}}}else{}}if(b){a.scrollTop=b.get(0).offsetTop+(a.scrollHeight-a.clientHeight)-j.offsetTop}}}}}Horn.Util.stopPropagation(f)},onKeyUp:function(c){var b=this.listEl;var f=this;if(this.multipleline){var d=this.field.val();var a="";$("input[type='checkbox']",b).each(function(h,n){var g=$(n).parent().parent("li[key]");var l=g.attr("key");$(n).attr("checked",false);var m=d.split(",");var e=m.length;for(var k=0;k<e;k++){var j=m[k];if(l==j){a=a+m[k]+",";$(n).attr("checked",true)}}if($(n).attr("checked")){g.addClass("h_cur")}else{g.removeClass("h_cur")}g.focus()});a=a.substring(0,a.length-1);f.hidden.val(a)}Horn.Util.stopPropagation(c)},bodyClick:function(c){if(c.target==c.data.inputEl.get(0)){$(document).one(this.bodyclicktype,c.data,Horn.Util.apply(this.bodyClick,this))}else{var b=c.data.listEl;var a=c.data.inputEl;this.hideList(a,b)}},listClick:function(d){var g=this;var a=$(d.currentTarget);var c=d.data.listEl;var b={};if(g.multipleline){var f=new Array();$("input[type='checkbox']:checked",c).each(function(e,i){var h=$(i).parent().parent("li[key]").attr("key");if(h){f.push(h)}});b.key=f.join(g.delimiter);b.text=b.key;if($("input[type='checkbox']",a).get(0).checked){a.addClass("h_cur")}else{a.removeClass("h_cur")}d.stopPropagation();this.setValue(b,true)}else{a.addClass("h_cur");a.siblings().removeClass("h_cur");this.setValue(a.attr("key"),true)}this.field.trigger("blur")},hideList:function(c,b){if(!b.data("show_name")){return}b.hide();var a=$("li[key]",b);a.unbind("click.li");b.data("show_name","")},longerList:false,changeToLongerList:function(){this.longerList=true},showList:function(j,e){this.handerHeadItem();var g=this;var f=j.prev();if(e.data("show_name")==f.attr("name")){return}this.hideAllList(e);var d={inputEl:j,listEl:e};if(e.offsetParent()!=j.offsetParent()){e.appendTo(j.offsetParent())}var h=j.position(),c=j.outerHeight();e.css("left",h.left+"px");e.css("top",(h.top+c)+"px");e.css("width",(j.outerWidth()*(this.longerList?2:1)-2)+"px");e.css("display","block");e.data("show_name",f.attr("name"));$(document).one(g.bodyclicktype,d,Horn.Util.apply(g.bodyClick,g));var b=$("li[key]",e);b.bind("click.li",d,Horn.Util.apply(g.listClick,g));b.removeClass("h_cur");var a=j.prev().val();if(this.multipleline){$("input[type='checkbox']",e).each(function(l,q){var k=$(q).parent().parent("li[key]");var o=k.attr("key");$(q).attr("checked",false);var p=a.split(",");for(var n=0;n<p.length;n++){var m=p[n];if(o==m){$(q).attr("checked",true)}}if($(q).attr("checked")){k.addClass("h_cur")}else{k.removeClass("h_cur")}k.focus()})}else{var i=e.children("ul").children("li[key='"+a+"']");i.addClass("h_cur");i.focus()}if(this.showLabel){this.listEl.find("span.hce_dictlabel").show()}else{this.listEl.find("span.hce_dictlabel").hide()}},hideAllList:function(a){$("div.hc_checkboxdiv").each(function(b,c){if(a.get(0)!=c){$(c).hide();$(c).data("show_name","")}})},selectLi:function(g,c){var b=this.listEl.children("ul").children("li");var f=null;for(var e=0;e<b.size();e++){var a=$(b.get(e));var d=a.attr("key");if(d&&d.indexOf(g)==0){f=a;break}}if(f==null&&!this.multipleline){for(var e=0;e<b.size();e++){var a=$(b.get(e));var d=a.attr("key");if(d&&d.indexOf(c)==0){f=a;break}}}if(f!=null){if(!this.multipleline){f.siblings().removeClass("h_cur");f.addClass("h_cur")}}return f},bind:function(b,a){this.field.bind(b,[this.hidden],a)},setEnable:function(a){if(a){this.field.removeAttr("disabled");this.hidden.removeAttr("disabled")}else{this.hidden.attr("disabled","disabled");this.field.attr("disabled","disabled")}}});Horn.Field.regFieldType("div.hc_select",Horn.Select);
Horn.ButtonPanel=Horn.extend(Horn.Base,{COMPONENT_CLASS:"ButtonPanel",init:function(){Horn.ButtonPanel.superclass.init.apply(this,arguments)},setEnable:function(b,a){if(typeof a!="boolean"){Horn.Tip.info("enabled属性只能是布尔型！");return}var c=this.el.find("button[name="+b+"]");if(c.length==0){Horn.Tip.info(b+",不存在！");return}if(typeof a=="undefined"||a){c.removeClass("h_btn-disabled");c.removeAttr("disabled")}else{c.addClass("h_btn-disabled");c.attr("disabled","disabled")}}});Horn.regUI("div.h_btndiv",Horn.ButtonPanel);Horn.regUI("div.hc_button-group",Horn.ButtonPanel);
Horn.fieldReady=function(a){Horn.Validate.init()};Horn.register(Horn.fieldReady);
Horn.Label=Horn.extend(Horn.Base,{COMPONENT_CLASS:"Label",el:null,dictName:null,staticDict:null,mutiValue:null,init:function(e){Horn.Label.superclass.init.apply(this,arguments);var d=this.params;if(d.name||d.hiddenName){this.name=d.name||d.hiddenName}this.mutiValue=$(e).attr("mutivalue");this.label=this.el.prev("span");this.hidden=this.el.find("input:hidden");if(!this.hidden.get(0)){this.hidden=this.el.next("input:hidden")}this.li=this.el.parent();if(this.hidden){this.el.parent().append(this.hidden)}var j=d.dictName,a=d.items,h=d.labelField||"label",k=d.valueField||"value",b=d.delimiter,l=this.hidden.get(0)?this.hidden.val():this.el.html();if(b==""||this.delimiter){this.delimiter=b;this.mutiValue=true}else{this.delimiter=","}if(a){var c={};for(var g=0;g<a.length;g++){var f=a[g];c[f[h]]=f[k]}a=c}if(j){this.dictName=j;a=Horn.getDict(j)}this.staticDict=a;if(l){this.setValue(l)}},setValue:function(d){d=$.trim(d);if(this.hidden){this.hidden.val(d)}var g=this.dictName,b=this.staticDict;var e=function(j){var i="";if(b){i=b[j]||j}else{if(g){var h=$(".hc_checkboxdiv[ref_target="+g+"_s]").find("li[key="+j+"]");i=h.attr("title")||j}else{i=j}}return i};var a="";var f=false;if(!d){d=""}if(this.mutiValue){var c=[];$(d.split(this.delimiter)).each(function(h,j){var i=e(j);c.push(i||j)});a=c.join(this.delimiter||",");f=true}else{a=e(d)}this.el.html(a);if(f){this.el.addClass("hc_texthide");this.el.attr("title",a)}},getValue:function(){if(this.hidden.get(0)){return this.hidden.val()}return this.el.text()},setLabel:function(a){this.label.html(a)},getLabel:function(){return this.label.html()},hide:function(){this.li.hide()},show:function(){this.li.show()}});Horn.regUI("div.hc_label",Horn.Label);
(function(a,b){a.CheckboxGroup=a.extend(Horn.Field,{COMPONENT_CLASS:"CheckboxGroup",checkboxs:null,init:function(){Horn.CheckboxGroup.superclass.init.apply(this,arguments);var f=this;this.name=this.el.attr("name");this.alias=this.el.attr("alias")||"";var e=this.el.find("input:checkbox");if(e.length>0){var c=e.first().attr("group");if(c){var d=c.split(";");b(d).each(function(g,h){f.checkGroup[h]=true})}}this.checkboxs={};this.el.find("input:checkbox").each(function(g,h){var i=b(h);var j=i.val();f.checkboxs[j]=i});if(this.params.value){this.setValue(this.params.value)}if(this.params.readonly){this.setReadonly(true)}if(this.params.disabled){this.setDisabled(true)}this.defValue=this.params.defValue||this.params.value||""},getEventTarget:function(){return this.el.find("input:checkbox")},setValue:function(e){var d=this;if(!b.isArray(e)){e=e.split(",")}for(var c in d.checkboxs){d.checkboxs[c].attr("checked",false)}b(e).each(function(f,g){var h=d.checkboxs[g];if(h){h.attr("checked",true)}})},getValue:function(){var c="";this.el.find("input:checkbox[checked]").each(function(d,f){var e=b(f).attr("value");if(e){if(d!=0){c+=","}c+=e}});return c},reset:function(){this.setValue(this.defValue)},clearValue:function(){this.setValue("")},setEnable:function(c){var d=this;this.el.find("input:checkbox").each(function(e,f){if(c===false){b(f).attr("disabled","disabled")}else{b(f).removeAttr("disabled")}})},setDisabled:function(c){if(c===false){this.setEnable(true);this.disabled=false}else{this.setEnable(false);this.disabled=true}},setReadonly:function(c){var d=this;this.el.find("input:checkbox").each(function(e,f){if(c===false){d.readonly=false;b(f).removeAttr("onclick");b(f).bind("click",function(){setTimeout(function(){var g=d.el.find("input:checkbox[checked]");if(g&&g.size()>0){d.removeError()}else{d.showError()}},10)})}else{d.readonly=true;if(d.el.find("input:checkbox[checked]").length==0){b(f).unbind("click")}b(f).get(0).onclick=function(){return false}}})},validate:function(){if(!this.skipValid&&this.checkRegx&&this.checkRegx.length>0){var d=this;if(d.disabled===true){d.err=false;return}var c=this.el.find("input:checkbox[checked]");if(c&&c.size()<1){Horn.Validate.addError(d,Horn.Validate.regexEnum.requiredMessage)}else{Horn.Validate.removeError(d)}}},initEvents:function(){var d=this;var c=d.el.find("input:checkbox[check*=required]");if(c&&c.size()>0){this.checkRegx=b(c[0]).attr("check").split(";");c.each(function(e,f){b(f).bind("click",function(){setTimeout(function(){var g=d.el.find("input:checkbox[checked]");if(g&&g.size()>0){d.removeError()}else{d.showError()}},10)})})}},showError:function(){var d=window.navigator.userAgent.toLowerCase();var c=b.browser.msie&&/msie 7\.0/i.test(d);var g=true;if(b.browser.msie){if(document.documentMode&&document.documentMode>=8){g=true}else{if(document.documentMode&&document.documentMode<8){g=false}}}var f=this;if(!this.msgDiv){this.msgDiv=b('<span class="hc_verification" style="display:none;"></span>');this.el.after(this.msgDiv)}var e=this.msgDiv;e.html("当前复选框不能为空");e.css("display","none");f.el.addClass("hc_ver-bd");f.el.mouseover(function(){if(e){var h=b(this).css("height");h=h.replace("px","");var i=parseInt(h)+1;if(!g||c){i=0}e.css("margin-top",i+"px");e.css("display","inline")}});f.el.mouseout(function(){if(e){e.css("display","none")}});f.err=true},removeError:function(){var d=this;d.el.unbind("mouseover");d.el.unbind("mouseout");d.el.removeClass("hc_ver-bd");d.err=false;var c=this.msgDiv;if(c){c.remove()}delete this.msgDiv},addRule:function(h){if(h&&h.indexOf(Horn.Validate.REQUIRED)>-1){var i=this;var e=i.el.find("input:checkbox[check*=required]");if(e&&e.size()>0){return}else{i.err=true;this.checkRegx=h.split(";");var d=i.el.find("input:checkbox");d.each(function(j,l){var k=b(l).attr(Horn.Validate.CHECK);if(k){if(k.indexOf(h)>-1){return}k+=Horn.Validate.CHECKSEP+h}else{k=h}b(l).attr(Horn.Validate.CHECK,k);b(l).bind("click",function(){setTimeout(function(){var m=i.el.find("input:checkbox[checked]");if(m&&m.size()>0){i.removeError()}else{i.showError()}},10)})});var c=i.el.parent();var f=b("span",c);var g=b("b.hc_red",f);if(!g.length){g=b("<b>",{"class":"hc_red",html:"*"});f.prepend(g)}else{g.html("*")}}}else{return}},removeRule:function(g){var h=this;var d=h.el.find("input:checkbox");d.each(function(i,l){var j=b(l).attr(Horn.Validate.CHECK);if(j&&j.indexOf(g)>-1){var k=j.split(Horn.Validate.CHECKSEP);k=b.grep(k,function(n,m){return n&&n!=g});b(l).attr(Horn.Validate.CHECK,k.join(";"))}b(l).unbind("click")});this.checkRegx=[];if(g&&g.indexOf(Horn.Validate.REQUIRED)>-1){var c=this.el.parent();var e=b("span",c);var f=b("b.hc_red",e);f.html("")}h.removeError()},setRequired:function(c){if(c===false){this.setNotRequired();return}else{if(c===true||c===undefined){this.addRule(Horn.Validate.REQUIRED)}}},setNotRequired:function(){this.removeRule(Horn.Validate.REQUIRED)}});a.Field.regFieldType("div.hc_checkbox-group",a.CheckboxGroup)})(Horn,jQuery);
Horn.Calendar=Horn.extend(Horn.Field,{COMPONENT_CLASS:"Calendar",init:function(dom){Horn.Calendar.superclass.init.apply(this,arguments);var input=this.el.children("input:text");var hidden=this.el.children("input:hidden");this.name=hidden.attr("name");this.alias=hidden.attr("alias");var config=this.el.attr("config");var settings={};if(config!=""&&typeof(config)!="undefined"){settings=eval("("+config+")")}if(!settings.format){settings.format=Horn.Calendar.DEFAULT_FORMAT}settings.btnBar=false;settings.onSetDate=function(){input.trigger("blur")};settings.real=hidden;var changeEvent=(input.data("events")||{})["change"];if(changeEvent&&changeEvent.length>0){settings.onchange=changeEvent[0].handler}this.calobj=input.calendar(settings);if(this.params.readonly){this.setReadonly(true)}if(this.params.disabled){this.setDisabled(true)}},getEventTarget:function(){return this.el.children("input:text")},setValue:function(a){this.field.val(a);this.hidden.val(a)},reset:function(a){this.field.val(a?"":this.defValue);this.hidden.val(a?"":this.defHiddenValue)},validate:function(){var a=this;if(!a.calobj.isValid()){a.showError("日期格式不正确")}else{a.removeError();Horn.Validate.onValid({data:[Horn.Validate,a]})}},isValid:function(){return(this.calobj.isValid()&&!this.err)?true:false},initEvents:function(){var a=this;a.checkRegx=[];var b=this.field.attr("checkstr");if(b){a.checkRegx=b.split(";")}this.field.blur(function(){setTimeout(function(){if(!a.calobj.isValid()){a.showError("日期格式不正确")}else{a.removeError();Horn.Validate.onValid({data:[Horn.Validate,a]})}},10)})},setEnable:function(a){if(a){this.field.removeAttr("disabled");this.hidden.removeAttr("disabled")}else{this.field.attr("disabled","disabled");this.hidden.attr("disabled","disabled")}}});Horn.apply(Horn.Calendar,{DEFAULT_FORMAT:"yyyy-MM-dd"});Horn.Field.regFieldType("div.hc_calendar",Horn.Calendar);
Horn.CalendarGroup=Horn.extend(Horn.Field,{COMPONENT_CLASS:"CalendarGroup",cal1:null,cal2:null,hidden1:null,hidden2:null,name1:null,name2:null,calobj1:null,calobj2:null,defValue1:"",defHiddenValue1:"",defValue2:"",defHiddenValue2:"",init:function(){Horn.CalendarGroup.superclass.init.apply(this,arguments);this.el.attr("tabIndex",1000);var g=$(this.el.find("input:text")[0]);var f=$(this.el.find("input:text")[1]);var c=$(this.el.find("input[type=hidden]")[0]);var b=$(this.el.find("input[type=hidden]")[1]);this.name1=c.attr("name");this.name2=b.attr("name");this.name=this.name1;this.alias=c.attr("alias");var a=this.params.config;var e={};var h=this;if(c){this.defHiddenValue1=(this.params.defValue1!=undefined)?this.params.defValue1:c.val()}if(b){this.defHiddenValue2=(this.params.defValue2!=undefined)?this.params.defValue2:b.val()}if(g){this.defValue1=(this.params.defValue1!=undefined)?this.params.defValue1:g.val()}if(f){this.defValue2=(this.params.defValue2!=undefined)?this.params.defValue2:f.val()}if(a!=""&&typeof(a)!="undefined"){e=a}if(!e.format){e.format=Horn.Calendar.DEFAULT_FORMAT}var d=(g.data("events")||{})["change"];if(d&&d.length>0){e.onchange=d[0].handler}this.minDate=this._formatDate(e.minDate);this.maxDate=this._formatDate(e.maxDate);if(!g.attr("readonly")){g.focus(function(i){var j=Horn.apply({},e);var k=h._formatDate(h.cal2.val());k=!!Date.parse(k)?k:"";if(!h.compareDate(h.minDate,k)||!h.compareDate(k,h.maxDate)){k=h.maxDate}j=Horn.apply(j,{minDate:!!Date.parse(h.minDate)?h.minDate.replace(/\//g,"-"):"",maxDate:k.replace(/\//g,"-"),real:c,btnBar:false,onSetDate:function(){setTimeout(function(){g.evented=true;g.blur()},100)}});h.calobj1=g.calendar(j);g.evented=true});g.blur(function(){if(g.readonly==true){return}if(h.calobj1&&!h.calobj1.isValid()||h.calobj1&&!h.calobj1.isValid()){h.showError("日期格式不正确")}else{if(h.calobj1&&(!h.compareDate(h.calobj1.getDate(),h.maxDate)||!h.compareDate(h.minDate,h.calobj1.getDate()))||h.calobj2&&(!h.compareDate(h.calobj2.getDate(),h.maxDate)||!h.compareDate(h.minDate,h.calobj2.getDate()))){h.showError("日期不在有效区间")}else{if(h.calobj1&&h.calobj1.isValid()&&h.calobj2&&h.calobj2.isValid()&&h.calobj1.getDate()&&h.calobj2.getDate()){if(h.calobj1.getDate()&&h.calobj2.getDate()&&h.calobj1.getDate()>h.calobj2.getDate()){h.showError("开始日期不能大于结束日期")}}else{var i=g.attr("check");if(i&&i.indexOf(Horn.Validate.REQUIRED)>-1&&(!g.val()||!f.val())){h.showError("当前输入不能为空")}}}}})}if(!f.attr("readonly")){f.focus(function(i){var k=Horn.apply({},e);var j=h._formatDate(h.cal1.val());j=!!Date.parse(j)?j:"";if(!h.compareDate(h.minDate,j)||!h.compareDate(j,h.maxDate)){j=h.minDate}k=Horn.apply(k,{maxDate:!!Date.parse(h.maxDate)?h.maxDate.replace(/\//g,"-"):"",minDate:j.replace(/\//g,"-"),real:b,btnBar:false,onSetDate:function(){setTimeout(function(){f.evented=true;f.blur()},100)}});h.calobj2=f.calendar(k);f.evented=true});f.blur(function(){if(f.readonly==true){return}if(h.calobj2&&!h.calobj2.isValid()||h.calobj1&&!h.calobj1.isValid()){h.showError("日期格式不正确")}else{if(h.calobj1&&(!h.compareDate(h.calobj1.getDate(),h.maxDate)||!h.compareDate(h.minDate,h.calobj1.getDate()))||h.calobj2&&(!h.compareDate(h.calobj2.getDate(),h.maxDate)||!h.compareDate(h.minDate,h.calobj2.getDate()))){h.showError("日期不在有效区间")}else{if(h.calobj1&&h.calobj1.isValid()&&h.calobj2&&h.calobj2.isValid()&&h.calobj1.getDate()&&h.calobj2.getDate()){if(h.calobj1.getDate()>h.calobj2.getDate()){h.showError("开始日期不能大于结束日期")}}else{var i=f.attr("check");if(i&&i.indexOf(Horn.Validate.REQUIRED)>-1&&(!f.val()||!g.val())){h.showError("当前输入不能为空")}}}}})}this.cal1=g;this.hidden1=c;this.cal2=f;this.hidden2=b;if(this.params.disabled){this.setEnable(false)}},getEventTarget:function(){return this.el.find("input:text")},_formatDate:function(a){if(a.indexOf("/")==-1&&a.indexOf("-")==-1&&a.length>=8){return a.substring(0,4)+"/"+a.substring(4,6)+"/"+a.substring(6)}return a.replace(/-/g,"/")},compareDate:function(b,a){b=this._formatDate(b);a=this._formatDate(a);if(!Date.parse(b)||!Date.parse(a)){return true}return Date.parse(b)<=Date.parse(a)},setValue:function(b){var a=this;this.cal1.val(b[this.name1]);this.hidden1.val(b[this.name1]);this.cal2.val(b[this.name2]);this.hidden2.val(b[this.name2])},getValue:function(){var a=this.get();var b="";$.each(a,function(c,d){b+=","+$(d).val()});return b.indexOf(",")==0?b.substring(1):b},mutiName:function(){return[this.name1,this.name2]},validate:function(){var a=this;a.cal1.focus();a.cal2.focus();a.el.focus();a.el.blur()},isValid:function(){var a=true;var e=this;if(e.params.disabled&&e.params.disabled==true){return true}if(!this.cal1.evented){this.cal1.focus()}if(!this.cal2.evented){this.cal2.focus()}e.el.focus();e.el.blur();var f=this.cal1.attr("check");if(f&&f.indexOf(Horn.Validate.REQUIRED)>-1&&!this.cal1.val()){e.showError("当前输入不能为空");a=false}var d=this.cal2.attr("check");if(d&&d.indexOf(Horn.Validate.REQUIRED)>-1&&!this.cal2.val()){e.showError("当前输入不能为空");a=false}var c=this.calobj1.getDate();var b=this.calobj2.getDate();return a&&this.calobj1.isValid()&&this.calobj2.isValid()&&this.compareDate(c,this.maxDate)&&this.compareDate(this.minDate,c)&&this.compareDate(b,this.maxDate)&&this.compareDate(this.minDate,b)&&c<=b},setEnable:function(a){if(a){this.cal1.removeAttr("disabled");this.cal2.removeAttr("disabled");this.hidden1.removeAttr("disabled");this.hidden2.removeAttr("disabled")}else{this.cal1.attr("disabled","disabled");this.cal2.attr("disabled","disabled");this.hidden1.attr("disabled","disabled");this.hidden2.attr("disabled","disabled")}},reset:function(a){var b=this;this.cal1.val(a?"":this.defValue1);this.hidden1.val(a?"":this.defHiddenValue1);this.cal2.val(a?"":this.defValue2);this.hidden2.val(a?"":this.defHiddenValue2)}});Horn.Field.regFieldType("div.hc_calendargroup",Horn.CalendarGroup);
Horn.Combox=Horn.extend(Horn.Select,{COMPONENT_CLASS:"Combox",pLabel:"",filterFlag:"",displayField:null,keyAttr:"label",pKeyAttr:"pkey",valueAttr:"value",defaultValue:"",defaultText:"",showLabel:true,init:function(e){Horn.Combox.superclass.init.apply(this,arguments);this.combInit();var d=this.el.find("input[ref]"),a=this.el.attr("keyfield"),b=this.el.attr("pkeyfield"),c=this.el.attr("titlefield");if(a){this.keyAttr=a}if(b){this.pkeyAttr=b}if(c){this.valueAttr=c}var f=this.params.dictName;if(f){this.field.attr("ref",f.split(",")[0]+(this.multipleline?"_m":"_s"))}this.displayField=d;this.defaultValue=this.params.value||this.hidden.val();if(this.params.readonly){this.setReadonly(true)}},combInit:function(){var a=this.hidden.attr("refname");if(a){this.field.bind("change",Horn.Util.apply(this.onCombChange,this))}},onCombChange:function(g,h){var b=this.hidden.attr("refname");var f=b.split(";");for(var c=0;c<f.length;c++){var d=f[c];if(d){var a=d.split(",");Horn.getComp(a[0],a[1]).filterByPLabel(this.hidden.val())}}},changeDict:function(a){this.clearFliter();if((this.field.get(0)).getAttribute("multiple")=="true"){a+="_m"}else{a+="_s"}this.field.attr("ref",a);this.listEl=$("div.hc_checkboxdiv[ref_target='"+a+"']");this.multipleline=this.listEl.attr("multiple_line")=="true";this.setValue("")},selectFirst:function(){var a=this.listEl.children("ul").children("li[key]");var c="";var d="";for(var b=0;b<a.length;b++){if($(a.get(b)).css("display")!="none"){c=$(a.get(b)).attr("key");d=jQuery.trim($(a.get(b)).text());break}}this.setValue({key:c,text:d},true)},getPos:function(){return{left:0,top:0}},hideAllList:function(){var a=this.listEl;$("div.hc_checkboxdiv").each(function(b,c){if(a.get(0)!=c){$(c).hide();$(c).data("show_name","")}})},showList:function(d,c){var b=d.prev();var a=b.data("filter");if(a){this[a.name].apply(this,a.params)}else{this.clearFliter(b)}Horn.Combox.superclass.showList.apply(this,arguments)},filterByPLabel:function(a){if(this.pLabel!=a){this.reset(true);this.pLabel=a;this.hidden.data("filter",{name:"_filterByPLabel",params:arguments})}},_filterByPLabel:function(c,a){if(!c){return false}var b=this.listEl.children("ul");b.children("li[key][pKey!='"+c+"']").css("display","none");b.children("li[key][pKey='"+c+"']").css("display","block");if(this.defaultValue){this.setValue(this.defaultValue)}else{if(!(a===false)&&(!this.multipleline)){this.selectFirst()}else{this.setValue("")}}},filter:function(g,a,c){var e={name:"_filter",params:arguments};var d=this.hidden.data("filter");if(e!=d){this.hidden.data("filter",e);if(c){this.field.trigger("change",e)}}var h=this.hidden.val();var b=this;if(h){this._filter(g,a);setTimeout(function(){$(h.split(",")).each(function(f,i){if(b.listEl.children("ul").children("li[key="+i+"]").css("display")=="none"){b.reset(true)}})},200)}else{this._filter(g,a);setTimeout(function(){b.setValue("")},200)}},_filter:function(e,b){b=!!b;var d="block",c="none";if(b){d="none";c="block"}var a=this.listEl.children("ul").children("li[key]");a.css("display",d);var g=",";if($.type(e)=="string"){e+=g}a.each(function(h,j){var f=$(j);var i=f.attr("key");if($.type(e)=="function"){if(e.call(this,i)){f.css("display",c)}}else{if($.type(e)=="array"){if(jQuery.inArray(i,e)>=0){f.css("display",c)}}else{if($.type(e)=="string"){if(e.indexOf(i+g)>-1){f.css("display",c)}}}}})},clearFliter:function(){this.listEl.children("ul").children("li[key]").css("display","block");this.hidden.data("filter",null)},clearList:function(){this.reset(true);this.listEl.children("ul").children("li[key]").remove()},addItems:function(b,a){this.addDatas(b,a)},addDatas:function(c,b){var i=[],k=this.listEl,d=this.keyAttr,a=this.valueAttr,e=this.showLabel;var f=this.hidden;var g=this;var l={inputEl:this.field,listEl:k};if(jQuery.type(c)=="array"){i=c}else{if(jQuery.isPlainObject(c)){if(jQuery.isEmptyObject(c)){return}i.push(c)}}if(b===true){this.clearList()}if(i.length>0){var h=k.children("ul");var j=(k.attr("multiple_line")=="true");$.each(i,function(o,q){var p=q[d],r=q[a];if(!p){p=q.code;r=q.text}if(p){var m=h.children("li[key='"+p+"']");if(m.length==0){var m=$("<li key='"+p+"' title='"+r+"'></li>");var n=$("<label></label>");n.text((e?p+":":"")+r);if(j){n.prepend('<input type="checkbox" />')}m.append(n);h.append(m);if(k.data("show_name")==f.attr("name")){m.bind("click.li",l,Horn.Util.apply(g.listClick,g))}}}})}},showError:function(){Horn.Combox.superclass.showError.apply(this,arguments);var a=this.msgDiv}});Horn.Field.regFieldType("div.hc_combox",Horn.Combox);
Horn.CheckCode=Horn.extend(Horn.Field,{COMPONENT_CLASS:"CheckCode",img:null,src:null,first:true,init:function(){Horn.CheckCode.superclass.init.apply(this,arguments);var b=this;var a=this.img=this.el.find("img");a.css("cursor","pointer");a.attr("title","点击刷新");a.click(function(){var c=a.attr("src");a.attr("src","");if(b.first){b.src=c;b.first=false}a.attr("src",b.src+"?r="+new Date().getTime())})},isValid:function(){return true}});Horn.Field.regFieldType("div.hc_validcode",Horn.CheckCode);
Horn.SelectTree=Horn.extend(Horn.Field,{COMPONENT_CLASS:"SelectTree",hidden:null,field:null,ref:null,listEl:null,init:function(){Horn.SelectTree.superclass.init.apply(this,arguments);this.field=this.el.children("input[type='text'][ref]");this.hidden=this.field.prev();this.name=this.hidden.attr("name");this.ref=this.field.attr("ref");this.field.bind({focus:Horn.Util.apply(this.onFocus,this)});this.initZTree()},initZTree:function(){var g=this.field.attr("onchange");if(g){}var k=Horn.getCurrent();this.listEl=k.find("div.hc_selectbox-tree-div[ref_target='"+this.ref+"']");if(this.listEl.length==0){var c=this.hidden.attr("name").replace(/\./,"_");var i=[];i.push("<div class='hc_selectbox-tree-div' ref_target='ztree_"+c+"'>");i.push("<div class='hc_selectbox-tree-left'>");i.push("<ul class='ztree' id='ztree_"+c+"'>");i.push("</ul>");i.push("</div>");i.push("<div class='hc_selectbox-tree-right'>");i.push("<ul class='ztree'>");i.push("</ul>");i.push("</div>");i.push("</div>");var n=k.find("div.hc_hide_div-tree");if(n.length==0){n=$('<div class="hc_hide_div-tree"></div>').appendTo(k)}this.listEl=$(i.join("")).appendTo(n)}var f=$.fn.zTree.getZTreeObj(this.ref);if(f){return true}var h=this.listEl.children("div.hc_selectbox-tree-left").children("ul.ztree");var d=this.hidden.attr("checkbox")=="checkbox"||this.hidden.attr("checkbox")=="radio";var e=this.hidden.attr("checkbox")||"checkbox";var j=this.hidden.attr("dictName");var p=context_path;var m=this.hidden.attr("root_id")||"";var b=this.field.attr("url")||"/horn/dict/getEntries.htm?format=json";var o={treeId:this.ref,view:{selectedMulti:false,showLine:true,showIcon:true},check:{enable:d,chkStyle:e,autoCheckTrigger:false,chkboxType:{Y:"",N:""}},data:{key:{name:"name",title:"name"},simpleData:{enable:true,idKey:"id",pIdKey:"pId"}},callback:{onCheck:this.onCheck,onClick:this.onCheck,onAsyncSuccess:function(r,q,s,t){},onAsyncError:function(r,q,s,u,v,t){},beforeCheck:this.onBeforeCheck},async:{enable:true,dataType:"json",type:"get",url:l,dataFilter:function(t,q,s){var r=s.entries;return r}}};function l(s,r){var q=b.indexOf("?")>-1?"&":"?";if(r){return p+b+q+"key="+r.id+"&pageNo=0&dictName="+j}return p+b+q+"key="+m+"&pageNo=0&dictName="+j}var a=$.fn.zTree.init(h,o);a.thisScope=null},onBeforeCheck:function(a,c){var b=$.fn.zTree.getZTreeObj(a);var d=b.thisScope;return(function(){var f=this.hidden.attr("isLevelSelect")=="true";var e=this.hidden.attr("checkbox")=="checkbox"||this.hidden.attr("checkbox")=="radio";if(e){if(f){if(this.hidden.data("level")!=undefined&&c.level!=this.hidden.data("level")){return false}this.hidden.data("level",c.level)}}}).apply(d,arguments)},onCheck:function(d,c,b){var a=$.fn.zTree.getZTreeObj(c);var f=a.thisScope;return(function(){var g=a.getCheckedNodes();var e=this.hidden.attr("checkbox")=="checkbox"||this.hidden.attr("checkbox")=="radio";if(g.length==0){this.hidden.removeData("level")}var g=new Array();if(e){g=a.getCheckedNodes()}else{g=a.getSelectedNodes()}this.showLog.call(this,g,a,e)}).apply(f,arguments);this.field.trigger("blur")},showLog:function(a,c,b){var i="dark";var d=[];var h=[];var j=[];var g=[];var f=this.listEl.children("div.hc_selectbox-tree-left").children("ul.ztree");var e=f.parent().next("div.hc_selectbox-tree-right").children("ul.ztree");$.each(a,function(l,n){var m="ztree_node_"+n.tId;var o=n.name;var k=n.id;j.push(o);g.push(k);d.push(m);h.push(n.tId);e.children("li[zid='"+m+"']");if(e.children("li[zid='"+m+"']").length==0){e.append("<li class='"+i+"' zid='"+m+"'>"+o+"</li>")}});e.children("li").each(function(l,k){var m=$(k);if(jQuery.inArray(m.attr("zid"),d)==-1){m.remove()}});this.hidden.val(g.join(","));if(b){this.field.val(g.join(","))}else{this.field.val(j.join(","))}this.hidden.attr("tids",h.join(","));this.field.trigger("change",[this.hidden.val(),this.field.val(),a,this.hidden,this.field])},clearLog:function(){var a=this.listEl.children("div.hc_selectbox-tree-right").children("ul.ztree");a.children("li").remove()},onFocus:function(g){var k=$(g.currentTarget);var f=k.attr("ref");var j=$("div.hc_selectbox-tree-div[ref_target='"+f+"']");if(j.length>0){this.showTree(k,j);var h=$.fn.zTree.getZTreeObj(f);h.thisScope=this;h.currentTarget=k;var b=this.hidden.attr("checkbox")=="checkbox"||this.hidden.attr("checkbox")=="radio";this.clearLog(h);h.checkAllNodes(false);h.selectNode(null,false);if(this.hidden.val()){tIdArrs=this.hidden.attr("tids")||"";tIdArrs=tIdArrs.split(",");var a=[];for(var d=0;d<tIdArrs.length;d++){if(tIdArrs[d]){var c=h.getNodeByTId(tIdArrs[d]);a.push(c);if(b){h.checkNode(c,true,true,false)}else{h.selectNode(c,false)}}}this.showLog(a,h,b)}}},hideTree:function(c,b){if(!b.data("show_name")){return}b.hide();b.data("show_name",false);var d=c.attr("ref");var a=$.fn.zTree.getZTreeObj(d);a.thisScope=null;a.currentTarget=null},showTree:function(d,c){if(c.data("show_name")){return}this.hideAllList(c);var b={inputEl:d,listEl:c};var e=d.offset(),a=d.outerHeight();var f=c.get(0).style;f.left=(e.left)+"px";f.top=(e.top+a)+"px";c.show();c.data("show_name",true);c.bind("click.ztree.list",b,function(g){Horn.Util.stopPropagation(g)});$(document).one("click.combo.body",b,Horn.Util.apply(this.bodyClick,this))},hideAllList:function(a){$("div.hc_selectbox-tree-div").each(function(b,c){if(a.get(0)!=c){$(c).hide();$(c).data("show_name","")}})},bodyClick:function(c){var b=c.data.inputEl;if(c.target==b.get(0)){$(document).one("click.combo.body",c.data,Horn.Util.apply(this.bodyClick,this))}else{var a=c.data.listEl;this.hideTree(b,a)}},setEnable:function(a){if(a){this.field.removeAttr("disabled");this.hidden.removeAttr("disabled")}else{this.field.attr("disabled","disabled");this.hidden.attr("disabled","disabled")}}});Horn.Field.regFieldType("div.hc_select-tree",Horn.SelectTree);
Horn.SwitchField=Horn.extend(Horn.Field,{COMPONENT_CLASS:"SwitchField",LABELLISTSIZE:5,li:null,label:null,div:null,field:null,listEl:null,exDiv:null,labellistdiv:null,labelspan:null,labelfield:null,labellistul:null,labeltext:null,red:null,url:null,events:{},param:[],init:function(a){Horn.SwitchField.superclass.init.apply(this,arguments);this.initScope(a);this.initEvent()},initScope:function(f){var d=$(f);var e=null;if(d.prop("tagName")=="INPUT"){e=d}else{if(d.prop("tagName")=="DIV"&&d.hasClass("hc_switchfield")){e=d.children("input[type='text']").first()}}if(e==null){return}this.field=e;this.div=this.field.parent("div.hc_switchfield");this.label=this.div.prev("span");this.li=this.el.parent("li");this.listEl=this.div.children("div.hc_checkboxdiv").first();this.exDiv=this.div.next("div");this.labellistdiv=this.li.children("div.hc_switchfieldlabel");this.labelspan=this.labellistdiv.children("div").first();this.labelfield=this.labelspan.find("input[type='hidden']");this.labellistul=this.labellistdiv.children("ul").first();this.red=this.labelspan.find("b.hc_red").first();if(this.red.length==0){this.labelspan.prepend("<b class='hc_red'></b>");this.red=this.labelspan.children("b.hc_red").first()}if(this.red.length){this.labeltext=this.red.get(0).nextSibling}if(!this.labeltext){this.labeltext=this.labelspan.find("span").get(0).firstChild}if(this.labeltext.nodeType!=3){this.labelspan.prepend("&nbsp;");this.labeltext=this.labelspan.find("span").get(0).firstChild}this.url=context_path+this.field.attr("url");var g=["labelChange","change","beforeSend","complete","dataFilter","error","success"];for(var b=0;b<g.length;b++){var c=g[b];var a=this.field.attr(c);if(a){this.events[c]=Horn.Util.getFunObj(a)}}this.labellistul.hide()},initEvent:function(){this.field.bind(this.getEvent("input"));this.labelspan.bind(this.getEvent("labelspan"));var b=this.labelspan.next("ul").children("li");b.bind("click.switchlabel",Horn.Util.apply(this.labelListClick,this));var a=this.labelfield.val();if(this.events.labelChange){this.field.bind("labelChange",Horn.Util.apply(this.events.labelChange["fn"],this))}this.field.trigger("labelChange",[a,""])},labelListClick:function(d){var b=$(d.currentTarget);var a=b.attr("key");var f=$.trim(b.text());var c=this.labelfield.val();if(a!=c){this.labeltext.nodeValue=f;this.labelspan.attr("title",f);this.labelfield.val(a);this.setValue("",true);b.siblings().removeClass("h_cur");b.addClass("h_cur");this.field.trigger("labelChange",[a,c]);this.labellistul.hide()}},selectFirst:function(){var a=this.listEl.children("ul").first().children("li[key]");var c="";for(var b=0;b<a.length;b++){if($(a.get(b)).css("display")!="none"){c=$(a.get(b)).attr("key");break}}this.setValue(c,true)},setValue:function(a,c){if(a===undefined||a===null){return false}var b=this.field.val();this.field.val(a);if(c&&a!=b){this.field.trigger("change",[a,b])}},getLabelValue:function(){return this.labelfield.val()},setLabelValue:function(a){var c=undefined;this.labellistul.children("li").each(function(g,f){f=$(f);if(f.attr("key")==a){c=f;if(!f.hasClass("h_cur")){f.addClass("h_cur")}}else{f.removeClass("h_cur")}});var b=a;var e=$.trim(c.text());var d=this.labelfield.val();if(b!=d){this.labeltext.nodeValue=e;this.labelspan.attr("title",e);this.labelfield.val(b);this.setValue("",true);this.field.trigger("labelChange",[b,d])}},getEvent:function(b){var c={focus:Horn.Util.apply(this.showList,this),blur:function(d){},change:Horn.Util.apply(function(h,g,d){if(!h.currentTarget.value){return}var i=[];i=i.concat(this.param);i.push({name:this.field.attr("name"),value:this.getValue()});i.push({name:this.labelfield.attr("name"),value:this.getLabelValue()});var f={async:true,data:i,timeout:1000*60,context:this,dataType:"json",type:"POST",beforeSend:Horn.Util.apply(this.onBeforeSend,this),complete:Horn.Util.apply(this.onComplete,this),dataFilter:Horn.Util.apply(this.onDataFilter,this),error:Horn.Util.apply(this.onError,this),success:Horn.Util.apply(this.onSuccess,this)};$.ajax(this.url,f)},this),labelChange:Horn.Util.apply(function(h,d,g){var f=jQuery.map(this.getCookieList(d),function(e){return{label:e,value:e}});this.addDatas(f,true)},this)};if(b=="input"){return c}var a={click:Horn.Util.apply(function(d){this.labellistul.show();$(document).one("click",Horn.Util.apply(this.bodyClickForLabel,this))},this)};if(b=="labelspan"){return a}},onBeforeSend:function(a){if(this.events.beforeSend&&$.type(this.events.beforeSend["fn"])=="function"){return this.events.beforeSend["fn"].apply(this,arguments)}return true},onComplete:function(a,b){if(this.events.complete&&$.type(this.events.complete["fn"])=="function"){this.events.complete["fn"].apply(this,arguments)}},onDataFilter:function(b,a){if(this.events.dataFilter&&$.type(this.events.dataFilter["fn"])=="function"){return this.events.dataFilter["fn"].apply(this,arguments)}return b},onError:function(b,c,a){if(this.events.error&&$.type(this.events.error["fn"])=="function"){this.events.error["fn"].apply(this,arguments)}},onSuccess:function(c,d,b){var a=this.labelfield.val();this.addCookieList(a,this.getValue());this.field.trigger("labelChange",[a,""]);if(this.events.success&&$.type(this.events.success["fn"])=="function"){this.events.success["fn"].apply(this,arguments)}},bodyClick:function(a){if(a.target==this.field.get(0)){$(document).one("click",Horn.Util.apply(this.bodyClick,this))}else{this.hideList()}},bodyClickForLabel:function(a){if(a.target==this.labelspan.get(0)||$(a.target).parent().get(0)==this.labelspan.get(0)){$(document).one("click",Horn.Util.apply(this.bodyClickForLabel,this))}else{this.labellistul.hide()}},listClick:function(d){var b=$(d.currentTarget);var c=this.field;var a=c.val();c.val($.trim(b.text()));b.addClass("h_cur");b.siblings().removeClass("h_cur");if(a!=c.val()){c.trigger("change",[c.val(),a])}},hideList:function(){if(!this.listEl.css("display")=="none"){return}this.listEl.css("display","none");var a=this.listEl.children("ul").first().children("li[key]");a.unbind("click.li")},showList:function(){if(this.listEl.css("display")=="block"){return}var b=this.listEl.children("ul").first().children("li[key]");var d=this.field.offset(),a=this.field.outerHeight();this.listEl.css("left",d.left+"px");this.listEl.css("top",(d.top+a)+"px");this.listEl.css("width",(this.field.outerWidth()-2)+"px");this.listEl.css("display","block");$(document).one("click",Horn.Util.apply(this.bodyClick,this));b.bind("click.li",Horn.Util.apply(this.listClick,this));b.removeClass("h_cur");var c=this.field.val();this.listEl.children("ul").children("li[key='"+c+"']").addClass("h_cur")},reset:function(){this.setValue("")},clearList:function(){this.listEl.children("ul").children("li[key]").remove()},addDatas:function(d,a){var c=[];if(jQuery.type(d)=="array"){c=d}else{if(jQuery.isPlainObject(d)){if(jQuery.isEmptyObject(d)){return}c.push(d)}}if(a){this.clearList()}if(c.length>0){var b=this.listEl.children("ul").first();$.each(c.reverse(),function(f,h){if(h.label){var e=b.children("li[key='"+h.label+"']");if(e.length==0){var g="<li key='"+h.label+"' title='"+h.value+"'><label>"+h.value+"</label></li>";b.prepend(jQuery(g))}else{e.css("display","block")}}})}},getLabelFlag:function(a){return"sf_"+a},getCookieList:function(a){return[]},addCookieList:function(b,a){},setCookie:function(a,b){},getCookie:function(a){},delCookie:function(a){}});Horn.Field.regFieldType("div.hc_switchfield",Horn.SwitchField);
Horn.ToogleField=Horn.extend(Horn.Field,{COMPONENT_CLASS:"ToogleField",btn:null,hidden:null,isOn:false,val:0,init:function(){Horn.ToogleField.superclass.init.apply(this,arguments);this.btn=this.el.find("button");this.hidden=this.el.find("input:hidden");this.field=this.hidden;this.val=this.hidden.val();var a=this;this.btn.click(function(){a.toogle();return false});this.name=this.hidden.attr("name")||Horn.id();this.alias=this.hidden.attr("alias")||""},getEventTarget:function(){return this.el.find("button")},setValue:function(a){if(0!=a&&1!=a){return}if(this.val==a){return}this.toogle()},toogle:function(){if("readonly"==this.field.attr("readonly")){return}if("disabled"==this.field.attr("disabled")){return}if(this.val==0){this.btn.removeClass("hc_switch-close");this.btn.addClass("hc_switch-open");this.val=1}else{this.btn.removeClass("hc_switch-open");this.btn.addClass("hc_switch-close");this.val=0}this.hidden.val(this.val);this.getEventTarget().trigger("change",this.val)},setEnable:function(a){if(typeof a!="boolean"){return}if(a){this.btn.removeClass("hc_switch-disabled");this.field.removeAttr("disabled");this.hidden.removeAttr("disabled")}else{this.btn.addClass("hc_switch-disabled");this.field.attr("disabled","disabled");this.hidden.attr("disabled","disabled")}}});Horn.Field.regFieldType("div.hc_switch",Horn.ToogleField);
Horn.FormGrid=Horn.extend(Horn.Base,{COMPONENT_CLASS:"FormGrid",init:function(e){Horn.FormGrid.superclass.init.apply(this,arguments);var f=this;var d=this.el;var b=d.children("a.h_btn-confirm");var c=b.next("a.h_btn-add");b.bind({click:function(){var j=d.nextAll("ul.h_panel");var g=null;for(var h=0;h<j.size();h++){var k=$(j.get(h));if(k.css("display")=="block"||k.css("display")==""){g=k;break}}if(g&&Horn.Validate.isFormValidate(g)){if(!f.fire("beforechange",g)){return false}f.rest_panel.call(f,d);if(!f.fire("afterchange",panel)){return false}}}});c.bind({click:function(){var g=f.firstPanel(d);if(!f.fire("beforechange",g)){return false}f.add_panel.call(f,d);if(!f.fire("afterchange",g)){return false}}});var a=d.nextAll(".h_formtable").find("tbody").children("tr");a.each(function(h,j){var g=f.firstPanel(d);var k=g.clone(false,true);k.attr("index",g.parent().children("ul.h_panel").size()-1);Horn.Field.findFieldsIn(k).each(function(i,l){var m=$(l);if(this.params){m.attr("nonamebyparams",true);m.name=this.params.name}});k.find("input,textarea").each(function(m,n){var l=$(n).attr("name");if(l){var i=l.indexOf(".")!=-1?l.replace(".","["+h+"]."):l+"["+h+"]";$(n).attr("name",i);$(n).val($(j).find('span[ref="'+i+'"]').text().trim())}});g.after($(k));k.css("display","none");Horn.getUIReady()(k,true);f.rest_panel($(d));f.cls_panel(g)});f.rest_panel(d)},rest_panel:function(d){var e=this;var b=-1;var c=$(d).nextAll("div.h_formtable").first().children("table").first();c.children("tbody").children("tr").remove();var a=this.firstPanel(d);while(a.hasClass("h_panel")){if(b==-1){a.css("display","block")}else{a.css("display","none");e.update_name(a,b)}if(a.css("display")=="none"){c.children("tbody").prepend("<tr></tr>").children("tr").first().bind({click:function(){e.show_panel.call(e,d,$(this))}});c.find("th").each(function(){if($(this).attr("ref")=="del"){$("<td><a>删除</a></td>").appendTo(c.children("tbody").children("tr").first())}else{var i=$(this).attr("ref");var h=i;if(i.indexOf(".")>-1){h=i.replace(".","["+b+"].")}else{h=i+"["+b+"]"}var g=$("[name='"+h+"']",a);if(g.attr("type")=="hidden"){g=g.next()}var f=Horn.Field.findInputComp(g);var j=f?f.getValue(true):g.val();$("<td><span ref='"+h+"'>"+j+"</span></td>").appendTo(c.children("tbody").children("tr").first())}})}b=b+1;a=a.next()}$(c).children("tbody").children("tr").each(function(){var f=$(this);$(this).children("td").last().children("a").bind({click:function(){e.del_panel.call(e,d,$(f).nextAll("tr").size())}})});$(d).children("a.h_btn-confirm").hide().next("a.h_btn-add").show()},update_name:function(b,a){$(b).find("input,textarea").each(function(){if($(this).attr("name")){var c=$(this).attr("name");if(c.indexOf("[")<0){if(c.indexOf(".")>-1){c=c.replace(".","["+a+"].")}else{c=c+"["+a+"]"}}else{c=c.substr(0,(c.indexOf("[")+1))+a+c.substr(c.indexOf("]"))}$(this).attr("name",c)}})},add_panel:function(c){var a=this.firstPanel(c);if(Horn.Validate.isFormValidate(a)){var b=a.clone(false,true);b.attr("index",a.parent().children("ul.h_panel").size()-1);a.after($(b));b.css("display","none");Horn.getUIReady()(b,true);this.rest_panel($(c));this.cls_panel(a)}},firstPanel:function(a){return $(a).next("ul.h_panel").first()},cls_panel:function(a){Horn.Field.findFieldCompsIn(a).each(function(b,c){c.removeError()})},del_panel:function(d,b){var c=0;var a=this.firstPanel(d).next("ul");while($(a).hasClass("h_panel")){if(c==b){$(a).remove()}a=$(a).next();c=c+1}this.rest_panel(d)},show_panel:function(f,e){var d=this.firstPanel(f);$(e).parent("tbody").children("tr").removeClass("hc_formtable-cur");var b=$(e).addClass("hc_formtable-cur").nextAll("tr").size();d.hide();var c=0;var a=d.next("ul");while($(a).hasClass("h_panel")){if(c==b){$(a).show()}else{$(a).hide()}a=$(a).next();c=c+1}$(f).children("a.h_btn-confirm").show().next("a.h_btn-add").hide()},size:function(){this.el.next("table").children("tbody").children("tr").length}});Horn.regUI("div.h_formgridtitle",Horn.FormGrid);
Horn.Grid=Horn.extend(Horn.Base,{COMPONENT_CLASS:"Grid",titleEl:null,data:null,curData:null,curTr:null,rowSelect:false,keyAttr:"label",valueAttr:"value",init:function(c){Horn.Grid.superclass.init.apply(this,arguments);this.ths=this.el.find("th");var e=this;var b=this.params.data||{};this.data=b;if(this.params.selectModel=="muti"||this.params.selectModel=="multi"){this.mutiSelect=true}this.curTr=this.el.find("tr.hc_formtable-cur");var a=this.el.children("table").children("tbody").children("tr");this.curData=this.data[a.index(this.curTr)-1];this.rowSelect=Boolean(this.params.rowSelect);this.textOverHidden=this.params.textOverHidden?this.params.textOverHidden:false;this.ths.each(function(k,g){var i=g.attributes.hidden;g=$(g);var l=g.attr("dictName"),m=g.attr("colno"),f;var h=g.attr("width");var j,n;if(m){j=e.params.items[m-1].items;n=e.params.items[m-1].buttons}if(i!=null&&i!=undefined&&i.value=="true"){g.hide()}if(l){f={};var o=$(".hc_checkboxdiv[ref_target="+l+"_s]").find("li");o.each(function(q,p){p=$(p);var r=p.attr("title");var s=p.attr("key");f[s]=r})}else{if(j){f={};$(j).each(function(p,q){f[q[e.keyAttr]]=q[e.valueAttr]})}else{if(h){g.width(h)}}}g.data("staticDict",f);g.data("buttons",n)});this.el.find(".h_querytable_select_all").change(function(){if(this.checked){e.selectAll()}else{e.unSelectAll()}});this.titleEl=this.el.find("div.h_formgridtitle");var d=this.params.titleButtons;this.titleEl.find("a").each(function(f){var g=$(this);var i=g.attr("onclick");var h=d[f]["disabled"];if(!i||!Horn.Util.getFunObj(i).fn){g.hide()}if(h){g.addClass("h_btn-disabled");g.removeAttr("onclick");g.click(function(j){j.preventDefault()})}});this.selecteds={};this.dictTrans();this.initEvents();if(this.textOverHidden){this.resetTHWidth()}this.hiddenColumns()},customEvents:"rowclick,rowdblclick",getEventTarget:function(){return this.el},initEvents:function(){var c=this.el.children("table");var k=c.children("tbody");var h=this;if(this.rowSelect==true){k.children("tr").each(function(o,q){var r=o;var n=$(q),p=h.mutiSelect?n.find("input:checkbox.h_querytable_select"):n.find("input:radio.h_querytable_select");n.bind("click",function(i){if($.isEmptyObject(h.selecteds)){h.selectRow(r,n)}else{if(h.lastSelect&&h.lastSelect.rowidx!=r){if(!h.selecteds.hasOwnProperty(r)){h.selectRow(r,n)}else{h.unSelectRow(r,n)}}else{h.unSelectRow(r,n)}}})})}var m=undefined;var j=undefined;var b=undefined;var a=undefined;var f=this.data;$.each(this.params.events||[],function(n,p){h[p.event.toLowerCase()]=p["function"]});if(this.rowclick){m=Horn.Util.getFunObj(this.rowclick);if($.type(m.fn)=="function"){b=m.fn}}if(this.rowdblclick){j=Horn.Util.getFunObj(this.rowdblclick);if($.type(j.fn)=="function"){a=j.fn}}if(b||a){var g=k.children("tr");for(var e=0;e<f.length;e++){var l=$(g.get(e));if(b){var d=m.params.slice(0);d.push(f[e],f);l.bind("click",d,function(n){var i=n.data;return m.fn.apply(this,i)})}if(a){var d=j.params.slice(0);d.push(f[e],f);l.bind("dblclick",d,function(n){var i=n.data;return j.fn.apply(this,i)})}}}},setTitle:function(a){this.titleEl.children("span").text(a)},onRowSelect:function(){},selecteds:null,selectAll:function(){var a=this;this.el.find("input:checkbox.h_querytable_select").each(function(b,c){c.checked=true;if(a.rowSelect==false){$(c).trigger("change")}else{a.selectRow(b)}});this.el.find(".h_querytable_select_all").attr("checked",true)},unSelectAll:function(){var a=this;this.el.find("input:checkbox.h_querytable_select").each(function(b,c){c.checked=false;if(a.rowSelect==false){$(c).trigger("change")}else{a.unSelectRow(b)}});this.el.find(".h_querytable_select_all").attr("checked",false)},lastSelect:null,mutiSelect:false,selectRow:function(b,d){var c=this;var g=d;if(!g){g=$(this.el.find("tr").has("td").get(b))}var h={};var f={};var a=this.ths;var e=g.find("td");a.each(function(m,j){var l=e.get(m),k=$(j);if(k.attr("name")){h[k.attr("name")]=k.attr("dictName")?$(l).attr("key"):$(l).text();f[k.attr("name")]=$(l).text()}});c.onRowSelect.call(g,g,b,h);this.selecteds[b]={val:h,displays:f};if(!c.mutiSelect){var i=c.lastSelect;if(i&&i.rowidx!=b){if(this.mutiSelect){i.tr.find("input:checkbox").get(0).checked=false}else{i.tr.find("input:radio").get(0).checked=false}c.unSelectRow(i.rowidx,i.tr)}}c.lastSelect={rowidx:b,tr:g};if(this.mutiSelect){g.find("input:checkbox").get(0).checked=true}else{g.find("input:radio").get(0).checked=true}g.addClass("h_table-over")},unSelectRow:function(c,a){var b=a;if(!b){b=$(this.el.find("tr").has("td").get(c))}this.selecteds[c]=null;delete this.selecteds[c];b.removeClass("h_table-over");if(this.mutiSelect){b.find("input:checkbox").get(0).checked=false;this.el.find(".h_querytable_select_all").attr("checked",false)}else{b.find("input:radio").get(0).checked=false}},getSelecteds:function(e){var d=[];for(var c in this.selecteds){var b=this.selecteds[c];if(b){var a=b.val;if(e===true){a=this.data[c]}else{if(e==1){a=b.displays}}d.push(a)}}return d},changeCurrent:function(a){if(!a instanceof $){a=this.el.children("tbody").children("tr")[a]}if(!this.curtr){this.curtr=this.el.find("tr.hc_formtable-cur")}var b=this.el.children("table").children("tbody").children("tr").index(this.curtr);this.curtr.removeClass("hc_formtable-cur");a.addClass("hc_formtable-cur");this.curtr=a;this.curData=this.data[b-1]},getCurrentData:function(){return this.curData},hiddenColumns:function(){var a=this.el.children("table").children("tbody").children("tr");var b=this.ths;b.each(function(f,e){var c=$(e);var d=e.attributes.hidden;if(d!=null&&d!=undefined&&d.value=="true"){c.hide();a.each(function(i,h){var k=$(h);var j=k.find("td");for(var g=0;g<j.length;g++){var l=$(j[g]);if(f==g){l.hide();break}}})}})},formatColumn:function(c,f,g){if(c=="DATE"){if(f==null||f==undefined||f.length==0){f="Y-m-d"}var d=new Date(Date.parse(g));var b=d.format(f);var e=new RegExp("NaN");if(e.test(b)){return g}else{return b}}else{if(c=="AMOUNT"){if(f==null||f==undefined||f.length==0){f="0,000.00"}return Horn.Util.Format.number(g,f)}}},resetTHWidth:function(){var c=this.ths;var e=c.size();var a=this.el.children("table");var f=a.width();var b=[];c.each(function(h,k){var i=$(k);if(i.hasClass("h_numbercolumn")||i.hasClass("h_querytable_checkboxcolumn")){i.addClass("h_table_th_extend")}else{if(k.attributes.hidden){var j=k.attributes.hidden;if(j!=null&&j!=undefined&&j.value=="true"){e--}}else{if(i.attr("width")){e--}else{b.push(i)}}}return true});var g=100/e;for(var d=0;d<b.length;d++){b[d].css("width",g.toFixed(2)+"%")}d},dictTrans:function(){var b=this,c=this.ths,a=this.el.find("tr");a.each(function(e,d){var g=$(d),f=b.mutiSelect?g.find("input:checkbox"):g.find("input:radio");if(f.hasClass("h_querytable_select")){if(b.rowSelect==false){f.change(function(){if(this.checked){b.selectRow(e-1,g)}else{b.unSelectRow(e-1,g)}})}if(f.attr("checked")){setTimeout(function(){b.selectRow(e,g)},3)}}g.find("td").each(function(h,m){var o=$(m);var n=$(c.get(h));var j=n.attr("dictname"),k=n.attr("multiple"),u=n.data("staticDict"),t=n.attr("renderer"),A=n.data("buttons"),i=n.attr("showwhenover"),v=n.attr("dataType"),z=n.attr("format");if(u){o.attr("key",o.text());var r=o.text()||"";if(k){var q=[];$(r.trim().split(",")).each(function(D,E){q.push(u[E]||E)});o.text(q.join(","));o.attr("title",q.join(","))}else{o.text(u[o.text().trim()]||o.text());o.attr("title",u[o.text().trim()]||o.text())}}else{if(j){o.attr("key",o.text());var r=o.text();var l=Horn.getDict(j);if(l){if(k){var q=[];$(r.split(",")).each(function(D,E){q.push(l[o.text()]||o.text())});o.text(q.join(","));o.attr("title",q.join(","))}else{o.text(l[o.text()]||o.text());o.attr("title",u[o.text().trim()]||o.text())}}else{var s=$(".hc_checkboxdiv[ref_target="+j+"_s]").find("li[key="+o.text()+"]");o.text(s.attr("title")||o.text())}}else{if(A){o.attr("title","");var x=A;var w=$("<span></span>");$(x).each(function(H,E){var F=Horn.Util.getFunObj(E.event);if(!F.fn){return}var D=$("<a href='javascript:void(0)'>"+E.label+"</a>"),G=o.text();D.click(function(){F.fn.call(D,{val:G,rowdata:b.data[e-1],alldata:b.data,table:b,rowidx:e,tdidx:h,tr:g,td:o})});w.append(D);if(H!=(x.length-1)){w.append(" | ")}});if(i){w.addClass("h_link-default")}o.html("");o.append(w)}else{if(v){var C=o.text();var B=b.formatColumn(v,z,C);o.text(B);o.attr("title",B)}}}}if(t){o.attr("key",o.text());o.attr("title","");var p=Horn.Util.getFunObj(t),r=o.text();if(!p.fn){return}var y=p.fn.call($(this),{val:r,rowdata:b.data[e-1],alldata:b.data,table:b,rowidx:e,tdidx:h,tr:g,td:o});if(y instanceof $){o.html("");o.append(y)}else{o.html(y)}}})})},addRowData:function(a){}});Horn.regUI("div.h_formtable",Horn.Grid);
var tabCount=0;var disableCount=0;var apiwidth="";var defMaxTabCn="";var moveLastFlag=false;Horn.TabPanel=Horn.extend(Horn.Base,{COMPONENT_CLASS:"TabPanel",scrollStep:100,maxLength:9999,ul:null,tabUl:null,tabUlDiv:null,liwidth:null,maxTabCn:10,rigthFlag:true,init:function(d){Horn.TabPanel.superclass.init.apply(this,arguments);var e=this;var b=this.el;e.liwidth=b.attr("liWidth");e.maxTabCn=b.attr("maxTabCn")!=""?b.attr("maxTabCn"):e.maxTabCn;var a=0;this.tabUl=b.children("div.h_tabul").first();this.tabUlDiv=this.tabUl.children("div.h_tabuldiv").first();this.ul=this.tabUlDiv.children("ul").first();var c=b.children("ul");if(defMaxTabCn==""){this.ul.append(c.children("li[ref]").detach()).children("li[ref]").each(function(f,g){a++;$(g).bind({click:function(){e.click.call(e,$(g))}});if(apiwidth!=""){$(g).css("width",apiwidth+"px")}else{if(e.liwidth!=""){$(g).css("width",e.liwidth+"px")}}});this.click(this.ul.children().first());if(a>e.maxTabCn){Horn.Msg.alert("提示","最多只能添加"+e.maxTabCn+"个标签,请检查！");return}}c.remove();this.movetab();this.doLayout();this.on("tabChange",function(f,g){if(!Horn.Validate.isFormValidate(g)){f.attr("title","该标签页下有未验证通过的内容");f.append('<span class="h_tabli-error"></span>')}else{f.find("span").remove();var h=f.attr("tipMsg");f.attr("title",h)}});var e=this;$(window).resize(function(){e.doLayout()})},click:function(obj){if(obj.length==0){return false}var tab=this;var _this=this;var a=this.el.find("li.h_cur");if(a.get(0)){var panel=$(obj).parent("ul").parent("div.h_tabuldiv").parent("div.h_tabul").parent("div.h_tabpanel").children("div.h_tabpanel-content[ref_target="+a.attr("ref")+"]");a.each(function(){var title=$(this).attr("tipMsg");$(this).attr("title",title)});if(!this.fire("tabChange",a,panel)){return}}$(obj).addClass("h_cur").siblings().removeClass("h_cur");var panels=$(obj).parent("ul").parent("div.h_tabuldiv").parent("div.h_tabul").parent("div.h_tabpanel").children("div.h_tabpanel-content");var panel=$(obj).parent("ul").parent("div.h_tabuldiv").parent("div.h_tabul").parent("div.h_tabpanel").children("div.h_tabpanel-content[ref_target="+$(obj).attr("ref")+"]");panels.each(function(){if($(this).css("display")!="none"){$(this).css("display","none")}});panel.css("display","block");var panelid=panel.attr("id");if(!panelid){panelid=Horn.id("tab-panel-content-");panel.attr("id",panelid)}var url=panel.attr("lazyload");if(!panel.attr("loaded")&&url){url=(url.indexOf("?")===-1?url+"?":url+"&")+"pagelet="+panelid;var _this=this;$.ajax(url,{type:"get",error:function(xhr,textStatus,errorThrown){_this.renderTab(panel,{html:"",id:panelid,css:[],js:[],jsCode:""});panel.attr("loaded","true")},success:function(reqData,textStatus,jqXHR){_this.renderTab(panel,eval("("+reqData+")"));panel.attr("loaded","true")}})}else{Horn.enterToTab(Horn.getCurrent())}var ul_w=$(obj).parent("ul").css("width");var tab_w=$(obj).parent("ul").parent("div.h_tabuldiv").css("width");if(ul_w&&tab_w){ul_w=ul_w.replace("px","");tab_w=tab_w.replace("px","");if(parseInt(ul_w)>parseInt(tab_w)){var lastLiLen=$(obj).nextAll("li").length;if(_this.rigthFlag&&lastLiLen==0){moveLastFlag=true;_this.tabUl.children("a.h_tabrighta,a.h_tabrightacur").first().triggerHandler("click")}}}},locate:function(a){this.click(this.getTitle(a))},enable:function(a){disableCount--;var b=this.getTitle(a);if($(b).css("display")=="none"){$(b).css("display","block");$(b).parent("ul").parent("div.h_tabuldiv").parent("div.h_tabul").parent("div.h_tabpanel").children("div.h_tabpanel-content[ref_target="+a+"]").css("display","block");this.click($(b))}},disable:function(b){disableCount++;var c=this.getTitle(b);var a=$(c).parent("ul").children("li").length;if(disableCount==a){Horn.Msg.alert("提示","至少要有一个标签");this.click($(c));return}if($(c).css("display")!="none"){$(c).css("display","none");$(c).parent("ul").parent("div.h_tabuldiv").parent("div.h_tabul").parent("div.h_tabpanel").children("div.h_tabpanel-content[ref_target="+b+"]").css("display","none");this.click($(c).parent("ul").children("li").not("li[ref="+b+"]")[0])}},doLayout:function(){var g=this;var h=g.tabUlDiv;var l=$("a.h_tabrighta,a.h_tabrightacur",h.parent());var d=$("a.h_tablefta,a.h_tableftacur",h.parent());var i=h.children("ul");var b=50;var a=g.el.width();var k=a-d.outerWidth()-l.outerWidth();var e=-50;var j=0;i.children("li").each(function(){var m=$(this);if(m.hasClass("h_cur")){e+=b;j=m.outerWidth()}b+=m.outerWidth()});h.width(k);i.width(b);var f=h.prop("scrollWidth");if(k<f){l.removeClass("h_tabrighta").addClass("h_tabrightacur")}else{l.removeClass("h_tabrightacur").addClass("h_tabrighta")}var c=h.scrollLeft();if(c+k<e+j){h.scrollLeft(c+(e+j-c-k))}if(c>e){h.scrollLeft(e)}if(h.scrollLeft()>0){d.removeClass("h_tablefta").addClass("h_tableftacur")}else{d.removeClass("h_tableftacur").addClass("h_tablefta")}this.setSize();Horn.enterToTab(Horn.getCurrent());if(window.doLayout){doLayout()}},setSize:function(){var d=this;var b=d.tabUlDiv;var c=$("a.h_tabrighta,a.h_tabrightacur",b.parent());var e=$("a.h_tablefta,a.h_tableftacur",b.parent());var f=d.el.width();var a=f-e.outerWidth()-c.outerWidth();b.width(a)},movetab:function(){var d=this;var c=this.tabUl.children("a.h_tablefta");if(c.length<1){c=this.tabUl.children("a.h_tableftacur")}var b=this.tabUl.children("a.h_tabrighta");if(b.length<1){b=this.tabUl.children("a.h_tabrightacur")}var a=this.tabUlDiv;b.bind("click",function(){d.rigthFlag=true;if(b.hasClass("h_tabrighta")){return}var g=a.prop("scrollLeft");var f=a.prop("offsetWidth");var e=a.prop("scrollWidth");a.scrollLeft(g+d.scrollStep);g=a.scrollLeft();if(g>0){c.removeClass("h_tablefta").addClass("h_tableftacur")}if(f+g>=e){b.removeClass("h_tabrightacur").addClass("h_tabrighta")}d.setSize()});c.bind("click",function(){d.rigthFlag=false;if(c.hasClass("h_tablefta")){return}var g=a.prop("scrollLeft");var f=a.prop("offsetWidth");var e=a.prop("scrollWidth");a.scrollLeft(g-d.scrollStep);g=a.scrollLeft();if(f+g<e){b.removeClass("h_tabrighta").addClass("h_tabrightacur")}if(g==0){c.removeClass("h_tableftacur").addClass("h_tablefta")}d.setSize()})},getTitle:function(a){var b=this.ul.children("li[ref='"+a+"']");return b},activate:function(c){var f=this;var b=this.getTitle(c);var a=$(b).nextAll("li").length;var j=$(b).prevAll("li").length;var l=f.liwidth!=""?f.liwidth:f.scrollStep;var k=100;var g=this.tabUlDiv;var d=g.prop("scrollLeft");var i=$(b).parent("ul").parent("div.h_tabuldiv").css("width");if(i){d=i.replace("px","")}d=parseInt(d);l=parseInt(l);var h=g.prop("offsetWidth");var e=g.prop("scrollWidth");if(a==0){k=d+l}else{if(j==0){d=0;k=d-l}else{if(j>a){k=d+(j-a)/2*l}else{if(a>j){k=d-(a+j)/2*l-100}else{k=d+l}}}}g.prop("scrollLeft",k);this.click.call(this,b);this.setSize()},renderTab:function(c,b){var a=c.attr("ref_target");c.children().remove();if((b.html&&b.html.length>3)||(b.jsCode&&b.jsCode.length>3)){BigPipe.onArrive(b);Horn.setCurrent(c);BigPipe.start();Horn.init()}var d=c.children("div").children("h1").children("span").html();$("div.h_tabuldiv").children("ul").children('li[ref="'+a+'"]').children("a").children("b").text(d);this.activate(a)},addTab:function(params){var _this=this;if(params.url){if(params.url==""){Horn.Msg.alert("提示","标签url不能为空！");return}}else{Horn.Msg.alert("提示","标签url必填，请检查！");return}if(params.width){_this.liWidth=params.width}else{if(_this.liwidth!=""){_this.liWidth=_this.liwidth}}apiwidth=_this.liWidth;if(params.maxTabCn&&params.maxTabCn>0){defMaxTabCn=params.maxTabCn}else{if(_this.maxTabCn!=""){defMaxTabCn=_this.maxTabCn}}if(params.name&&this.getTitle(params.name).get(0)){this.activate(params.name);return}else{tabCount++}if(tabCount>defMaxTabCn){Horn.Msg.alert("提示","最多只能添加"+defMaxTabCn+"个标签");return}var tabpanel=this.el;var ul=this.ul;var ref=params.name||("h_tab-uldiv-"+new Date().getTime());var refID=Horn.id("tab-uldiv-");if(typeof params.title!="string"||params.title.trim()<1){params.title="未命名标签"}ul.append("<li  ref='"+ref+"' style='"+_this.liWidth+"' title='"+params.title+"' tipMsg='"+params.title+"'>"+params.title+"</li>");var newAppendLi=ul.children("li[ref='"+ref+"']");tabpanel.append('<DIV style="DISPLAY: block" class="h_tabpanel-content" ref_target="'+ref+'" id="'+refID+'"></DIV>');var newAppendDiv=tabpanel.children("div[ref_target='"+ref+"']");var url=params.url;url=(url.indexOf("?")===-1?url+"?":url+"&")+"pagelet="+refID;var _this=this;$.ajax(url,{type:"get",error:function(xhr,textStatus,errorThrown){_this.renderTab(newAppendDiv,{html:"",id:refID,css:[],js:[],jsCode:""});if(params.callback){params.callback()}},success:function(reqData,textStatus,jqXHR){_this.renderTab(newAppendDiv,eval("("+reqData+")"));if(params.callback){params.callback()}}});newAppendLi.bind({click:function(){_this.click.call(_this,newAppendLi)}});var tab=this.el;var tempul=tab.children("ul");tempul.remove();this.movetab();this.doLayout();return ref},closeTab:function(b){var a=this.ul.children("li[ref='"+b+"']");var c=this.el.children("div[ref_target='"+b+"']");a.remove();c.remove();var d=this.ul.children("li").last();if(d){this.click(d.get(0))}}});$.extend(Horn.TabPanel,{DATANAME:"h_tabpanel",get:function(b){var a=Horn.data(Horn.TabPanel.DATANAME);var c=a[0];return c},locate:function(a){Horn.TabPanel.get().locate(a)},enable:function(a){Horn.TabPanel.get().enable(a)},disable:function(a){Horn.TabPanel.get().disable(a)},doLayout:function(){Horn.TabPanel.get().doLayout()}});Horn.regUI("div.h_tabpanel",Horn.TabPanel);
Horn.QueryTable=Horn.extend(Horn.Base,{COMPONENT_CLASS:"QueryTable",table:null,form:null,dicName:null,delimiter:",",ths:[],simpleRequest:false,postData:null,rowSelect:false,keyAttr:"label",valueAttr:"value",clickFlag:null,init:function(e){Horn.QueryTable.superclass.init.apply(this,arguments);this.table=$(e);var a=this.params.baseparams||{};var b=this.params.bindformname;this.rowSelect=Boolean(this.params.rowSelect);var d={},c={request_num:10,index:this.INDEX_PAGE,positionArr:[],start_position_str:0,returndata:null,url:"",position_str:"position_str",hasPage:false,baseparams:a,params:{},autoLoad:false,requestMethod:"post"};if(b){this.form=Horn.getCurrent().find("form[name='"+b+"']");d=Horn.Util.getValues(this.form)}c.request_num=d.request_num||this.params.request_num||c.request_num;c.request_num=parseInt(c.request_num)>0?parseInt(c.request_num):10;c.autoLoad=Boolean(this.params.autoLoad);c.url=this.params.url;if(this.params.requestMethod&&(this.params.requestMethod.toLowerCase()=="post"||this.params.requestMethod.toLowerCase()=="get")){c.requestMethod=this.params.requestMethod}if(!c.url&&this.form&&this.form.length){c.url=this.form.attr("action")}if(c.url&&c.url.indexOf("http:")==-1){c.url=context_path+c.url}c.start_position_str=d.position_str||this.params.start_position_str||c.start_position_str;if(this.params.position_str){c.position_str=this.params.position_str}c.hasPage=Boolean(this.params.hasPage!=undefined||this.params.hasPage!=null?this.params.hasPage:c.hasPage);c.positionArr.push(c.start_position_str);this.postData=c;var g=this;this.ths=this.el.find("th");if(this.params.simpleRequest==true){this.simpleRequest=true}if(c.url&&c.autoLoad==true){g.loadByForm.call(g)}$.each(this.params.events||[],function(h,j){g[j.event.toLowerCase()]=j["function"]});this.mutiSelect=this.params.selectModel=="muti"||this.params.selectModel=="multi"||this.params.selectModel==""||this.params.selectModel==undefined;this.ths.each(function(l,i){var j=i.attributes.hidden;i=$(i);var m=i.attr("dictName"),n=i.attr("colno"),h=undefined;var k=undefined,o=undefined;if(n){k=g.params.items[n-1].items;o=g.params.items[n-1].buttons}if(j!=null&&j!=undefined&&j.value==true.toString()){i.hide()}if(m){h={};var p=$(".hc_checkboxdiv[ref_target="+m+"_s]").find("li");p.each(function(r,q){q=$(q);var s=q.attr("title");var t=q.attr("key");h[t]=s})}else{if(k){h={};$(k).each(function(q,r){h[r[g.keyAttr]]=r[g.valueAttr]})}}i.data("staticDict",h);i.data("buttons",o)});this.titleEl=this.el.parent().parent().find("div.h_formgridtitle");var f=this.params.titleButtons;this.titleEl.find("a").each(function(h){var i=$(this);var k=i.attr("onclick");var j=f[h]["disabled"];if(!Horn.Util.getFunObj(k).fn){i.hide()}if(j){i.addClass("h_btn-disabled");i.removeAttr("onclick");i.click(function(l){l.preventDefault()})}});this.selecteds=[];if(this.params.data){this.dictTrans();this.initEvents();this.hiddenColumns();this.lastList=this.params.data}this.el.find(".h_querytable_select_all").change(function(){if(this.checked){g.selectAll()}else{g.unSelectAll()}})},customEvents:"rowclick,rowdblclick",getEventTarget:function(){return this.el},stateTest:function(){var b=this;var a=true;b.el.find("input:checkbox.h_querytable_select").each(function(c,d){if(!$(d).attr("checked")){a=false}});if(a){b.el.find(".h_querytable_select_all").attr("checked",true)}else{b.el.find(".h_querytable_select_all").attr("checked",false)}},initEvents:function(){var a=this.el;var c=a.children("tbody");var d=this;var b=d.el.find(".h_querytable_select_all").length>0?true:false;if(b){this.el.find(".h_querytable_select").change(function(){d.stateTest()})}if(this.rowSelect==true){c.children("tr").each(function(f,j){var k=f;var e=$(j),h=d.mutiSelect?e.find("input:checkbox.h_querytable_select"):e.find("input:radio.h_querytable_select");var g=this.clickFlag;e.bind("click",function(i){clearTimeout(g);g=setTimeout(function(){if($.isEmptyObject(d.selecteds)){d.selectRow(k,e)}else{if(!d.selecteds.hasOwnProperty(k)){d.selectRow(k,e)}else{d.unSelectRow(k,e)}}if(b){d.stateTest()}},10)})})}},hiddenColumns:function(){var a=this.el.children("tbody").children("tr");var b=this.ths;b.each(function(f,e){var c=$(e);var d=e.attributes.hidden;if(d!=null&&d!=undefined&&d.value==true.toString()){c.hide();a.each(function(i,h){var k=$(h);var j=k.find("td");for(var g=0;g<j.length;g++){var l=$(j[g]);if(f==g){l.hide();break}}})}})},loadByForm:function(){var a={};if(this.form&&this.form.length){a=this.form.serializeArray()}this.load(a)},setBaseParams:function(a){if(a){this.postData.baseparams=a}else{this.postData.baseparams={}}},load:function(b){var a=this.postData;if(b){if($.type(b)=="array"){a.params=Horn.Util.arr2Obj(b)}else{a.params=b}}else{a.params={}}this.goPage(this.INDEX_PAGE)},INDEX_PAGE:1,nextpage:function(){this.goPage(this.postData.index+1)},prevpage:function(){this.goPage(this.postData.index-1)},firstpage:function(){this.goPage(this.INDEX_PAGE)},refreshpage:function(){this.ajaxRequest()},goPage:function(a){if(a<this.INDEX_PAGE){a=this.INDEX_PAGE}this.postData.index=a;this.ajaxRequest(this.el)},ajaxRequest:function(){var g=this,c=this.el,d=this.postData,f=d.positionArr,b=c.children("tbody"),e=d.params;e=$.extend({},d.baseparams,e);e.hasPage=d.hasPage;if(e!=null){e.position_str=f[d.index]||d.start_position_str;e.request_num=d.request_num+(this.simpleRequest?0:1)}if(this.simpleRequest){e.index=d.index}var a=this.ths.length;if(e.hasPage==false){}$.ajax(d.url,{async:true,beforeSend:function(h){b.html("<tr><td colSpan='"+a+"'><p class='h_loading'>正在加载</p></td></tr>")},type:d.requestMethod,data:Horn.Util.obj2Arr(e),dataType:"json",error:function(j,k,i){var h=j.status;b.html("<tr><td colSpan='"+a+"'><p>请求失败</p><p>错误状态："+h+"；错误信息："+k+"</p></td></tr>")},success:function(h,j,i){g.callback.call(g,g.doDataFilter(h));g.doCallBack(h);g.lastSelect=null;g.selecteds={}}})},doDataFilter:function(a){var b=this.table;var d=b.attr("datafilter");if(d){var c=Horn.Util.getFunObj(d);if(c&&$.type(c.fn)=="function"){a=c.fn.call(this,a)}}return a},doCallBack:function(a){var c=this.table;var d=c.attr("callback");if(d){var b=Horn.Util.getFunObj(d);if(b&&$.type(b.fn)=="function"){b.fn.call(this,a)}}$(".h_screen").height("auto");setTimeout(function(){if(window.doLayout){window.doLayout()}},1000);this.dictTrans()},callback:function(reqData){reqData=reqData||{total:0,rows:[]};if($.type(reqData)=="array"){reqData={rows:reqData}}var list=reqData.rows;var table=this.table;var _this=this;var htmlArr=[];var ths=this.ths;var colLength=ths.length;var isSuccess=false;var data=this.postData;this.lastList=list;this.selecteds=[];this.lastSelect={};this.el.find(".h_querytable_select_all").attr("checked",false);table.css("height","auto");if(list&&list.length>0){data.list=list.slice(0,data.request_num);isSuccess=true;for(var i=0;i<list.length;i++){var itemData=list[i];htmlArr.push("<tr>");ths.each(function(index,o){var th=$(o);if(th.hasClass("h_numbercolumn")){htmlArr.push("<td>"+(i+1)+"</td>");return}else{if(th.hasClass("h_querytable_checkboxcolumn")){htmlArr.push('<td><input type="checkbox" class="h_querytable_select"/></td>');return}else{if(th.hasClass("h_querytable_radioboxcolumn")){htmlArr.push('<td><input type="radio" class="h_querytable_select" name="_querytable_row_checker"/></td>');return}}}var name=th.attr("name");var dealFun=th.attr("dealFun");htmlArr.push("<td>");if(dealFun){var dFun=eval("(window."+dealFun+")");if($.type(dFun)=="function"){htmlArr.push(dFun(itemData[name],itemData,list,i,index))}}else{htmlArr.push(itemData[name])}htmlArr.push("</td>")});htmlArr.push("</tr>");if(i==data.request_num-1){data.positionArr[data.index+1]=itemData[data.position_str];break}}}else{if(reqData.errorInfo){data.list=[];htmlArr.push("<tr><td colspan='"+colLength+"'>");htmlArr.push("<p>"+reqData.errorInfo+"</p>");htmlArr.push("</td></tr>")}else{data.list=[];htmlArr.push("<tr><td colspan='"+colLength+"'>");htmlArr.push("<p>没有查询到数据</p>");htmlArr.push("</td></tr>")}}var tbody=table.children("tbody");tbody.html(htmlArr.join(""));if(isSuccess){tbody.children("tr:odd").addClass("h_table-odd");var rowClickObj=undefined;var rowDBLClickObj=undefined;var rowClickFn=undefined;var rowDBLClickFn=undefined;if(this.rowclick){rowClickObj=Horn.Util.getFunObj(this.rowclick);if($.type(rowClickObj.fn)=="function"){rowClickFn=rowClickObj.fn}}if(this.rowdblclick){rowDBLClickObj=Horn.Util.getFunObj(this.rowdblclick);if($.type(rowDBLClickObj.fn)=="function"){rowDBLClickFn=rowDBLClickObj.fn}}if(rowClickFn||rowDBLClickFn){var trs=tbody.children("tr");var _clickFlag=this.clickFlag;for(var i=0;i<data.list.length;i++){var tr=$(trs.get(i));if(rowClickFn){var params=rowClickObj.params.slice(0);params.push(data.list[i],data.list);tr.bind("click",params,function(e){var p=e.data;var _this=this;clearTimeout(_clickFlag);_clickFlag=setTimeout(function(){return rowClickObj.fn.apply(_this,p)},300)})}if(rowDBLClickFn){var params=rowDBLClickObj.params.slice(0);params.push(data.list[i],data.list);tr.bind("dblclick",params,function(e){clearTimeout(_clickFlag);var p=e.data;return rowDBLClickObj.fn.apply(this,p)})}}}this.initEvents();this.hiddenColumns()}table.css("height",table.css("height"));if(data.hasPage){var pageArr=[];if(data.index>_this.INDEX_PAGE){pageArr.push("<a href='javascript:void(0)' class='h_page-first'>首页</a>");pageArr.push("<a href='javascript:void(0)' class='h_page-pgLast'>上一页</a>")}else{pageArr.push("<a href='javascript:void(0)' class='h_page-dis'>首页</a>");pageArr.push("<a href='javascript:void(0)' class='h_page-dis'>上一页</a>")}if(isSuccess){pageArr.push("<a href='javascript:void(0)' class='h_page-refresh'>刷新</a>")}else{pageArr.push("<a href='javascript:void(0)' class='h_page-dis'>刷新</a>")}if(this.simpleRequest){if(list!=null&&(list.length+1)>data.request_num){pageArr.push("<a href='javascript:void(0)' class='h_page-pgNext'>下一页</a>")}else{pageArr.push("<a href='javascript:void(0)' class='h_page-dis'>下一页</a>")}}else{if(list!=null&&list.length>data.request_num){pageArr.push("<a href='javascript:void(0)' class='h_page-pgNext'>下一页</a>")}else{pageArr.push("<a href='javascript:void(0)' class='h_page-dis'>下一页</a>")}}var total_num=reqData.total;if(total_num!=undefined){var pagesnum=Math.ceil(parseInt(total_num)/parseInt(data.request_num));pageArr.push("<span>共"+pagesnum+"页，"+total_num+"条记录</span>")}var page=table.next("div.h_querytable_pages").html(pageArr.join(""));page.children("a.h_page-first").click(function(e){return _this.firstpage.call(_this,table,e)});page.children("a.h_page-pgLast").click(function(e){return _this.prevpage.call(_this,table,e)});page.children("a.h_page-pgNext").click(function(e){return _this.nextpage.call(_this,table,e)});page.children("a.h_page-refresh").click(function(e){return _this.refreshpage.call(_this,table,e)})}},loadData:function(a){this.callback(a);this.doCallBack(a)},onRowSelect:function(){},selecteds:null,selectAll:function(){var a=this;this.el.find("input:checkbox.h_querytable_select").each(function(b,c){c.checked=true;if(a.rowSelect==false){$(c).trigger("change")}else{a.selectRow(b)}});this.el.find(".h_querytable_select_all").attr("checked",true)},unSelectAll:function(){var a=this;this.el.find("input:checkbox.h_querytable_select").each(function(b,c){c.checked=false;if(a.rowSelect==false){$(c).trigger("change")}else{a.unSelectRow(b)}});this.el.find(".h_querytable_select_all").attr("checked",false)},lastSelect:null,mutiSelect:false,selectRow:function(h,b){var a=this;var g=b;if(!g){g=$(this.el.find("tr").has("td").get(h))}if(g.length==0){Horn.debug("querytable["+this.name+"]","选择的行"+h+"不存在");return false}var f={};var c=this.ths;var d=g.find("td");c.each(function(l,i){var k=d.get(l),j=$(i);f[j.attr("name")]=j.attr("dictName")?$(k).attr("key"):$(k).text()});a.onRowSelect.call(g,g,h,f);this.selecteds[h]=f;if(!a.mutiSelect){var e=a.lastSelect;if(e&&e.rowidx!==undefined&&e.rowidx!=h){if(e.tr.find("input:radio").length>0){e.tr.find("input:radio").get(0).checked=false}a.unSelectRow(e.rowidx,e.tr)}if(g.find("input:radio").length>0){g.find("input:radio").get(0).checked=true}}else{if(g.find("input:checkbox").length>0){g.find("input:checkbox").get(0).checked=true}}a.lastSelect={rowidx:h,tr:g};g.addClass("h_table-over")},unSelectRow:function(e,b){var d=b;if(!d){d=$(this.el.find("tr").has("td").get(e))}this.selecteds[e]=null;delete this.selecteds[e];d.removeClass("h_table-over");if(this.mutiSelect){if(d.find("input:checkbox").length>0){d.find("input:checkbox").get(0).checked=false}}else{if(d.find("input:radio").length>0){d.find("input:radio").get(0).checked=false}}var c=true;for(var a in this.selecteds){c=false;break}if(c){this.el.find(".h_querytable_select_all").attr("checked",false)}},getSelecteds:function(d){var c=[];if($.type(this.selecteds)=="array"){for(var b=0;b<this.selecteds.length;b++){var e=this.selecteds[b];if(e){c.push(d?this.lastList[b]:e)}}}else{for(var a in this.selecteds){var e=this.selecteds[a];if(e){c.push(d?this.lastList[a]:e)}}}return c},dictTrans:function(){var b=this,c=this.ths,a=this.el.find("tr");a.each(function(e,d){var g=$(d),f=b.mutiSelect?g.find("input:checkbox"):g.find("input:radio");if(f.hasClass("h_querytable_select")){if(b.rowSelect==false){f.change(function(){if(this.checked){b.selectRow(e-1,g)}else{b.unSelectRow(e-1,g)}})}}g.find("td").each(function(p,j){var k=$(j);var i=$(c.get(p));var n=i.attr("dictname"),o=i.attr("renderer"),q=i.data("buttons"),h=i.data("staticDict");if(h){k.attr("key",k.text());k.text(h[k.text()]||k.text())}else{if(n){k.attr("key",k.text());var t=$(".hc_checkboxdiv[ref_target="+n+"_s]").find("li[key="+k.text()+"]");k.text(t.attr("title")||k.text())}else{if(q){var m=q;var s=$("<span></span>");$(m).each(function(z,w){var x=Horn.Util.getFunObj(w.event);if(!x.fn){return}var v=$("<a href='javascript:void(0)'>"+w.label+"</a>");var y=k.text();v.click(function(){x.fn.call(v,{val:y,rowidx:e,tdidx:p,tr:g,td:k})});s.append(v);if(z!=(m.length-1)){s.append(" | ")}});k.html("");k.append(s)}}}if(o){k.attr("key",k.text());var u=k.text();var r=Horn.Util.getFunObj(o);if(!r.fn){return}var l=r.fn.call($(this),{val:u,rowidx:e,tdidx:p,tr:g,td:k});if(l instanceof $){k.html("");k.append(l)}else{k.html(l)}}})})}});$.extend(Horn.QueryTable,{DATANAME:"QUERYTABLE",get:function(a){var b=null;if(a){b=Horn.getComp(a)}else{b=Horn.data(Horn.QueryTable.DATANAME)[0]}return b}});Horn.regUI("table.h_querytable",Horn.QueryTable);
var Horn=Horn||{};(function(b){var c=function(h){var f='<div class="h_floatdiv h_floatdiv-extend"  id="h_msg_floatdiv"><div class="h_floatdiv-title"><span></span></div><div class="h_floatdiv-con" ><div class="hc_prompt msg-type-icon"><h2 class="hc_prompt-title"></h2><div class="hc_prompt-detail"></div></div></div><div class="h_btndiv h_btn-right"></div></div>';var m=$(f);if(h.msgTitle){m.find(".h_floatdiv-title span").html(h.msgTitle);m.find(".h_floatdiv-title").attr("title",h.msgTitle)}if(h.msgText){m.find(".hc_prompt-detail").html(h.msgText)}if(h.width){m.css("width",h.width+"px")}if(h.height){m.css("height",h.height+"px")}else{m.css("height","auto")}if(h.msgType){m.find(".msg-type-icon").removeClass("msg-type-icon").addClass(h.msgType)}var e='<button type="button" id="buttonOK" class="h_btn-submit">确定</button>';var k='<button type="button" id="buttonCancel" class="h_btn-cencel">取消</button>';var i=e+k;if(h.msgType&&h.msgType==Horn.Msg.CONFIRM){m.find(".h_btndiv").html(i)}else{m.find(".h_btndiv").html(e)}var j=$("<div></div>").append('<div class="h_floatdiv-backdrop" id="h_msg_bg"></div>').append(m.clone());var l=j.find(".h_btn-submit");if(l.length>0){l.unbind("click");l.bind("click",function(){j.remove();if(Horn.Window.getPrevOpen()<1){$("body").removeClass("h-overflow-hidden");$("html").removeClass("h-overflow-hidden")}if(h.onOK){h.onOK()}})}var g=j.find(".h_btn-cencel");if(g.length>0){g.unbind("click");g.bind("click",function(){j.remove();if(Horn.Window.getPrevOpen()<1){$("body").removeClass("h-overflow-hidden");$("html").removeClass("h-overflow-hidden")}if(h.onCancel){h.onCancel()}})}j.find(".h_floatdiv-backdrop").css("z-index",Horn.Window.getNextZIndex());j.find(".h_floatdiv-extend").css("z-index",Horn.Window.getNextZIndex());if(Horn.Window.getOpen()<1){$("body").addClass("h-overflow-hidden");$("html").addClass("h-overflow-hidden")}Horn.Window.getNextOpen();$("body").prepend(j);a(j.find(".h_floatdiv-extend"));$(window).resize(function(){if(j&&!j.is(":hidden")){a(j.find(".h_floatdiv-extend"))}});j.mousewheel(function(){return false})};var a=function(e){var l=$(window),g=e,j=0,f=0;var o=l.height();var k=l.width();var m=g.height();var i=g.width();j=o-m;f=k-i;var n=j/2+$(document).scrollTop();var h=f/2+$(document).scrollLeft();g.css("top",n+"px");g.css("left",h+"px")};var d=function(e){this.params={width:350};Horn.apply(this.params,e);c(this.params)};b.Msg={INFO:"hc_prompt-succeed",WARNING:"hc_prompt-warn",ERROR:"hc_prompt-wrong",CONFIRM:"hc_prompt-present",show:function(e){d(e)},alert:function(h,g,f){var e={msgTitle:h,msgText:g,onOK:f,msgType:this.INFO};d(e)},warning:function(h,g,f){var e={msgTitle:h,msgText:g,onOK:f,msgType:this.WARNING};d(e)},wraning:function(h,g,f){var e={msgTitle:h,msgText:g,onOK:f,msgType:this.WARNING};d(e)},error:function(h,g,f){var e={msgTitle:h,msgText:g,onOK:f,msgType:this.ERROR};d(e)},confirm:function(i,h,f,e){var g={msgTitle:i,msgText:h,onOK:f,onCancel:e,msgType:this.CONFIRM};d(g)}}})(Horn);
Horn.Canvas=Horn.extend(Horn.Base,{COMPONENT_CLASS:"Canvas",name:"",canvas:null,canvas_content:null,canvas_title:null,canvas_title_icon:null,init:function(){Horn.Canvas.superclass.init.apply(this,arguments);var c=this;this.canvas=this.el;this.name=this.canvas.attr("name");this.canvas_title=this.canvas.children().first();this.canvas_title_icon=this.canvas_title.children().first();this.canvas_content=this.canvas_title.next();var b;var a=this.canvas.attr("toggle");if(a){b=Horn.Util.getFunObj(a);if($.type(b.fn)=="function"){this.toggleFnObj=b}}this.canvas_title_icon.bind({click:function(){if($(this).hasClass("hc_open")){c.collapse()}else{c.expand()}}})},toggle:function(c){var b=this.toggleFnObj;if(!c){if($(this.canvas_title_icon).hasClass("hc_open")){this.collapse()}else{this.expand()}}if(b){var a=b.fn;var d=b.params.slice(0);d.push(c);a.apply(this,d)}},onExpand:function(){},expand:function(){var a=this.canvas_content;if(a.css("display")=="none"){a.css("display","block")}if(a.css("visibility")=="hidden"){a.css("visibility","visible")}$(this.canvas_title_icon).removeClass("hc_close");$(this.canvas_title_icon).addClass("hc_open");this.toggle("expand")},collapse:function(b){var a=this.canvas_content;var c="display"||b;if(c=="display"){a.css("display","none")}else{a.css("visibility","hidden")}$(this.canvas_title_icon).removeClass("hc_open");$(this.canvas_title_icon).addClass("hc_close");this.toggle("collapse")}});$.extend(Horn.Canvas,{expand:function(a){a.expand()},collapse:function(a,b){a.collapse(b)}});Horn.regUI("div.hc_canvas",Horn.Canvas);
Horn.ZtreePanel=Horn.extend(Horn.Base,{COMPONENT_CLASS:"ZtreePanel",el:null,url:null,params:null,treedata:null,beforeClick:function(){return true},onClick:function(){},check:false,chkStyle:"checkbox",init:function(h){Horn.ZtreePanel.superclass.init.apply(this,arguments);this.treeEl=this.el.find(".ztree");var g=this;if(this.el.attr("treeclick")){var d=this.el.attr("treeclick");if(d){d=window[d]}this.onClick=d}if(this.el.attr("beforetreeclick")){var d=this.el.attr("beforetreeclick");if(d){d=window[d]}this.beforeClick=d}if(this.el.attr("reRenderFn")){var d=this.el.attr("reRenderFn");if(d){d=window[d]}this.reRender=d}var c={data:{simpleData:{enable:true}},view:{nameIsHTML:true,showLine:false,showIcon:true,showTitle:true,selectedMulti:true,dblClickExpand:true,addDiyDom:function(k,j){var i="_a";var l=$("#"+j.tId+i);g.reRender(j,l)}},callback:{beforeClick:this.beforeClick,onClick:this.onClick}};var a=this.el.attr("checkMode");if(a){c.check={enable:true,chkStyle:a}}var f=this.el.attr("items");if(f){f=$.parseJSON(f)}else{f=[]}var e=this.treeEl;var b=this.treeEl.attr("id");if(!b){b=Horn.id();this.treeEl.attr("id",b)}$.fn.zTree.init(e,c,f);this.treedata=f;this.treeObj=$.fn.zTree.getZTreeObj(b);if(this.el.attr("expandfirst")){this.treeObj.expandAll(true)}},reRender:function(b,a){},getTreeObj:function(){return this.treeObj},getCheckedNodes:function(){return this.treeObj.getCheckedNodes()}});Horn.regUI("div.h_ztree",Horn.ZtreePanel);
Horn.ImagerPanel=Horn.extend(Horn.Base,{COMPONENT_CLASS:"ImagerPanel",el:null,images:[],NOTFOUND_IMG:"",nextText:"点击显示下一张",shown:{no:0,img:null},init:function(a){Horn.ImagerPanel.superclass.init.apply(this,arguments);this.initImages()},initImages:function(){var b=this.el.children("img"),d=this,c=this.el.attr("xwidth")||this.el.width()||500,a=this.el.attr("xheight")||this.el.height()||400;d.el.css("width",c);d.el.css("height",a);d.el.css("overflow","auto");b.each(function(e,f){f=$(f);f.attr("title",this.nextText);d.images.push(f);if(f.hasClass("h_img_show")){d.shown={no:e,img:f}}});b.click(function(){d.next()});b.error(function(){this.src=d.el.attr("notfound")||Horn.ImagerPanel.NOTFOUND_IMG})},showImg:function(c){if((c+1)>this.images.length||c<0){c=0}var a=this.shown.img;var b=this.images[c];if(a){a.removeClass("h_img_show")}if(b){b.addClass("h_img_show")}this.shown={no:c,img:b}},next:function(){this.showImg(this.shown.no+1)},prev:function(){this.showImg(this.shown.no-1)},setImages:function(a){$(this.images).each(function(c,d){d.remove()});var b=this;$(a).each(function(c,d){b.el.append("<img "+(c==0?'class="h_img_show"':"")+' src="'+d+'" />')});this.initImages()}});$.extend(Horn.ImagerPanel,{NOTFOUND_IMG:""});Horn.regUI("div.h_imager",Horn.ImagerPanel);
var Horn=Horn||{};(function(b,c){
/*!	SWFObject v2.2 <http://code.google.com/p/swfobject/> 
	is released under the MIT License <http://www.opensource.org/licenses/mit-license.php> 
*/
var a=function(){var G="undefined",u="object",V="Shockwave Flash",Z="ShockwaveFlash.ShockwaveFlash",t="application/x-shockwave-flash",U="SWFObjectExprInst",A="onreadystatechange",R=window,m=document,w=navigator,W=false,X=[k],r=[],Q=[],L=[],o,T,H,E,M=false,d=false,q,J,p=true,P=function(){var ad=typeof m.getElementById!=G&&typeof m.getElementsByTagName!=G&&typeof m.createElement!=G,ak=w.userAgent.toLowerCase(),ab=w.platform.toLowerCase(),ah=ab?/win/.test(ab):/win/.test(ak),af=ab?/mac/.test(ab):/mac/.test(ak),ai=/webkit/.test(ak)?parseFloat(ak.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,aa=!+"\v1",aj=[0,0,0],ae=null;if(typeof w.plugins!=G&&typeof w.plugins[V]==u){ae=w.plugins[V].description;if(ae&&!(typeof w.mimeTypes!=G&&w.mimeTypes[t]&&!w.mimeTypes[t].enabledPlugin)){W=true;aa=false;ae=ae.replace(/^.*\s+(\S+\s+\S+$)/,"$1");aj[0]=parseInt(ae.replace(/^(.*)\..*$/,"$1"),10);aj[1]=parseInt(ae.replace(/^.*\.(.*)\s.*$/,"$1"),10);aj[2]=/[a-zA-Z]/.test(ae)?parseInt(ae.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}}else{if(typeof R.ActiveXObject!=G){try{var ag=new ActiveXObject(Z);if(ag){ae=ag.GetVariable("$version");if(ae){aa=true;ae=ae.split(" ")[1].split(",");aj=[parseInt(ae[0],10),parseInt(ae[1],10),parseInt(ae[2],10)]}}}catch(ac){}}}return{w3:ad,pv:aj,wk:ai,ie:aa,win:ah,mac:af}}(),n=function(){if(!P.w3){return}if((typeof m.readyState!=G&&m.readyState=="complete")||(typeof m.readyState==G&&(m.getElementsByTagName("body")[0]||m.body))){i()}if(!M){if(typeof m.addEventListener!=G){m.addEventListener("DOMContentLoaded",i,false)}if(P.ie&&P.win){m.attachEvent(A,function(){if(m.readyState=="complete"){m.detachEvent(A,arguments.callee);i()}});if(R==top){(function(){if(M){return}try{m.documentElement.doScroll("left")}catch(aa){setTimeout(arguments.callee,0);return}i()})()}}if(P.wk){(function(){if(M){return}if(!/loaded|complete/.test(m.readyState)){setTimeout(arguments.callee,0);return}i()})()}v(i)}}();function i(){if(M){return}try{var ac=m.getElementsByTagName("body")[0].appendChild(F("span"));ac.parentNode.removeChild(ac)}catch(ad){return}M=true;var aa=X.length;for(var ab=0;ab<aa;ab++){X[ab]()}}function N(aa){if(M){aa()}else{X[X.length]=aa}}function v(ab){if(typeof R.addEventListener!=G){R.addEventListener("load",ab,false)}else{if(typeof m.addEventListener!=G){m.addEventListener("load",ab,false)}else{if(typeof R.attachEvent!=G){l(R,"onload",ab)}else{if(typeof R.onload=="function"){var aa=R.onload;R.onload=function(){aa();ab()}}else{R.onload=ab}}}}}function k(){if(W){Y()}else{K()}}function Y(){var aa=m.getElementsByTagName("body")[0];var ad=F(u);ad.setAttribute("type",t);var ac=aa.appendChild(ad);if(ac){var ab=0;(function(){if(typeof ac.GetVariable!=G){var ae=ac.GetVariable("$version");if(ae){ae=ae.split(" ")[1].split(",");P.pv=[parseInt(ae[0],10),parseInt(ae[1],10),parseInt(ae[2],10)]}}else{if(ab<10){ab++;setTimeout(arguments.callee,10);return}}aa.removeChild(ad);ac=null;K()})()}else{K()}}function K(){var aj=r.length;if(aj>0){for(var ai=0;ai<aj;ai++){var ab=r[ai].id;var ae=r[ai].callbackFn;var ad={success:false,id:ab};if(P.pv[0]>0){var ah=f(ab);if(ah){if(I(r[ai].swfVersion)&&!(P.wk&&P.wk<312)){z(ab,true);if(ae){ad.success=true;ad.ref=C(ab);ae(ad)}}else{if(r[ai].expressInstall&&D()){var al={};al.data=r[ai].expressInstall;al.width=ah.getAttribute("width")||"0";al.height=ah.getAttribute("height")||"0";if(ah.getAttribute("class")){al.styleclass=ah.getAttribute("class")}if(ah.getAttribute("align")){al.align=ah.getAttribute("align")}var ak={};var aa=ah.getElementsByTagName("param");var af=aa.length;for(var ag=0;ag<af;ag++){if(aa[ag].getAttribute("name").toLowerCase()!="movie"){ak[aa[ag].getAttribute("name")]=aa[ag].getAttribute("value")}}S(al,ak,ab,ae)}else{s(ah);if(ae){ae(ad)}}}}}else{z(ab,true);if(ae){var ac=C(ab);if(ac&&typeof ac.SetVariable!=G){ad.success=true;ad.ref=ac}ae(ad)}}}}}function C(ad){var aa=null;var ab=f(ad);if(ab&&ab.nodeName=="OBJECT"){if(typeof ab.SetVariable!=G){aa=ab}else{var ac=ab.getElementsByTagName(u)[0];if(ac){aa=ac}}}return aa}function D(){return !d&&I("6.0.65")&&(P.win||P.mac)&&!(P.wk&&P.wk<312)}function S(ad,ae,aa,ac){d=true;H=ac||null;E={success:false,id:aa};var ah=f(aa);if(ah){if(ah.nodeName=="OBJECT"){o=j(ah);T=null}else{o=ah;T=aa}ad.id=U;if(typeof ad.width==G||(!/%$/.test(ad.width)&&parseInt(ad.width,10)<310)){ad.width="310"}if(typeof ad.height==G||(!/%$/.test(ad.height)&&parseInt(ad.height,10)<137)){ad.height="137"}m.title=m.title.slice(0,47)+" - Flash Player Installation";var ag=P.ie&&P.win?"ActiveX":"PlugIn",af="MMredirectURL="+encodeURI(window.location).toString().replace(/&/g,"%26")+"&MMplayerType="+ag+"&MMdoctitle="+m.title;if(typeof ae.flashvars!=G){ae.flashvars+="&"+af}else{ae.flashvars=af}if(P.ie&&P.win&&ah.readyState!=4){var ab=F("div");aa+="SWFObjectNew";ab.setAttribute("id",aa);ah.parentNode.insertBefore(ab,ah);ah.style.display="none";(function(){if(ah.readyState==4){ah.parentNode.removeChild(ah)}else{setTimeout(arguments.callee,10)}})()}x(ad,ae,aa)}}function s(ab){if(P.ie&&P.win&&ab.readyState!=4){var aa=F("div");ab.parentNode.insertBefore(aa,ab);aa.parentNode.replaceChild(j(ab),aa);ab.style.display="none";(function(){if(ab.readyState==4){ab.parentNode.removeChild(ab)}else{setTimeout(arguments.callee,10)}})()}else{ab.parentNode.replaceChild(j(ab),ab)}}function j(af){var ae=F("div");if(P.win&&P.ie){ae.innerHTML=af.innerHTML}else{var ab=af.getElementsByTagName(u)[0];if(ab){var ag=ab.childNodes;if(ag){var aa=ag.length;for(var ad=0;ad<aa;ad++){if(!(ag[ad].nodeType==1&&ag[ad].nodeName=="PARAM")&&!(ag[ad].nodeType==8)){ae.appendChild(ag[ad].cloneNode(true))}}}}}return ae}function x(al,aj,ab){var aa,ad=f(ab);if(P.wk&&P.wk<312){return aa}if(ad){if(typeof al.id==G){al.id=ab}if(P.ie&&P.win){var ak="";for(var ah in al){if(al[ah]!=Object.prototype[ah]){if(ah.toLowerCase()=="data"){aj.movie=al[ah]}else{if(ah.toLowerCase()=="styleclass"){ak+=' class="'+al[ah]+'"'}else{if(ah.toLowerCase()!="classid"){ak+=" "+ah+'="'+al[ah]+'"'}}}}}var ai="";for(var ag in aj){if(aj[ag]!=Object.prototype[ag]){ai+='<param name="'+ag+'" value="'+aj[ag]+'" />'}}ad.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+ak+">"+ai+"</object>";Q[Q.length]=al.id;aa=f(al.id)}else{var ac=F(u);ac.setAttribute("type",t);for(var af in al){if(al[af]!=Object.prototype[af]){if(af.toLowerCase()=="styleclass"){ac.setAttribute("class",al[af])}else{if(af.toLowerCase()!="classid"){ac.setAttribute(af,al[af])}}}}for(var ae in aj){if(aj[ae]!=Object.prototype[ae]&&ae.toLowerCase()!="movie"){h(ac,ae,aj[ae])}}ad.parentNode.replaceChild(ac,ad);aa=ac}}return aa}function h(ac,aa,ab){var ad=F("param");ad.setAttribute("name",aa);ad.setAttribute("value",ab);ac.appendChild(ad)}function B(ab){var aa=f(ab);if(aa&&aa.nodeName=="OBJECT"){if(P.ie&&P.win){aa.style.display="none";(function(){if(aa.readyState==4){e(ab)}else{setTimeout(arguments.callee,10)}})()}else{aa.parentNode.removeChild(aa)}}}function e(ac){var ab=f(ac);if(ab){for(var aa in ab){if(typeof ab[aa]=="function"){ab[aa]=null}}ab.parentNode.removeChild(ab)}}function f(ac){var aa=null;try{aa=m.getElementById(ac)}catch(ab){}return aa}function F(aa){return m.createElement(aa)}function l(ac,aa,ab){ac.attachEvent(aa,ab);L[L.length]=[ac,aa,ab]}function I(ac){var ab=P.pv,aa=ac.split(".");aa[0]=parseInt(aa[0],10);aa[1]=parseInt(aa[1],10)||0;aa[2]=parseInt(aa[2],10)||0;return(ab[0]>aa[0]||(ab[0]==aa[0]&&ab[1]>aa[1])||(ab[0]==aa[0]&&ab[1]==aa[1]&&ab[2]>=aa[2]))?true:false}function y(af,ab,ag,ae){if(P.ie&&P.mac){return}var ad=m.getElementsByTagName("head")[0];if(!ad){return}var aa=(ag&&typeof ag=="string")?ag:"screen";if(ae){q=null;J=null}if(!q||J!=aa){var ac=F("style");ac.setAttribute("type","text/css");ac.setAttribute("media",aa);q=ad.appendChild(ac);if(P.ie&&P.win&&typeof m.styleSheets!=G&&m.styleSheets.length>0){q=m.styleSheets[m.styleSheets.length-1]}J=aa}if(P.ie&&P.win){if(q&&typeof q.addRule==u){q.addRule(af,ab)}}else{if(q&&typeof m.createTextNode!=G){q.appendChild(m.createTextNode(af+" {"+ab+"}"))}}}function z(ac,aa){if(!p){return}var ab=aa?"visible":"hidden";if(M&&f(ac)){f(ac).style.visibility=ab}else{y("#"+ac,"visibility:"+ab)}}function O(ab){var ac=/[\\\"<>\.;]/;var aa=ac.exec(ab)!=null;return aa&&typeof encodeURIComponent!=G?encodeURIComponent(ab):ab}var g=function(){if(P.ie&&P.win){window.attachEvent("onunload",function(){var af=L.length;for(var ae=0;ae<af;ae++){L[ae][0].detachEvent(L[ae][1],L[ae][2])}var ac=Q.length;for(var ad=0;ad<ac;ad++){B(Q[ad])}for(var ab in P){P[ab]=null}P=null;for(var aa in a){a[aa]=null}a=null})}}();return{registerObject:function(ae,aa,ad,ac){if(P.w3&&ae&&aa){var ab={};ab.id=ae;ab.swfVersion=aa;ab.expressInstall=ad;ab.callbackFn=ac;r[r.length]=ab;z(ae,false)}else{if(ac){ac({success:false,id:ae})}}},getObjectById:function(aa){if(P.w3){return C(aa)}},embedSWF:function(ae,ak,ah,aj,ab,ad,ac,ag,ai,af){var aa={success:false,id:ak};if(P.w3&&!(P.wk&&P.wk<312)&&ae&&ak&&ah&&aj&&ab){z(ak,false);N(function(){ah+="";aj+="";var am={};if(ai&&typeof ai===u){for(var ao in ai){am[ao]=ai[ao]}}am.data=ae;am.width=ah;am.height=aj;var ap={};if(ag&&typeof ag===u){for(var an in ag){ap[an]=ag[an]}}if(ac&&typeof ac===u){for(var al in ac){if(typeof ap.flashvars!=G){ap.flashvars+="&"+al+"="+ac[al]}else{ap.flashvars=al+"="+ac[al]}}}if(I(ab)){var aq=x(am,ap,ak);if(am.id==ak){z(ak,true)}aa.success=true;aa.ref=aq}else{if(ad&&D()){am.data=ad;S(am,ap,ak,af);return}else{z(ak,true)}}if(af){af(aa)}})}else{if(af){af(aa)}}},switchOffAutoHideShow:function(){p=false},ua:P,getFlashPlayerVersion:function(){return{major:P.pv[0],minor:P.pv[1],release:P.pv[2]}},hasFlashPlayerVersion:I,createSWF:function(ac,ab,aa){if(P.w3){return x(ac,ab,aa)}else{return undefined}},showExpressInstall:function(ac,ad,aa,ab){if(P.w3&&D()){S(ac,ad,aa,ab)}},removeSWF:function(aa){if(P.w3){B(aa)}},createCSS:function(ad,ac,ab,aa){if(P.w3){y(ad,ac,ab,aa)}},addDomLoadEvent:N,addLoadEvent:v,getQueryParamValue:function(ad){var ac=m.location.search||m.location.hash;if(ac){if(/\?/.test(ac)){ac=ac.split("?")[1]}if(ad==null){return O(ac)}var ab=ac.split("&");for(var aa=0;aa<ab.length;aa++){if(ab[aa].substring(0,ab[aa].indexOf("="))==ad){return O(ab[aa].substring((ab[aa].indexOf("=")+1)))}}}return""},expressInstallCallback:function(){if(d){var aa=f(U);if(aa&&o){aa.parentNode.replaceChild(o,aa);if(T){z(T,true);if(P.ie&&P.win){o.style.display="block"}}if(H){H(E)}}d=false}}}}();b.ImageBox=b.extend(b.Base,{COMPONENT_CLASS:"ImageBox",el:null,toolbar:null,pageBtn:null,zoomBox:null,maxImg:null,images:[],totalPage:1,curPage:1,backdrop:null,init:function(j){b.ImageBox.superclass.init.apply(this,arguments);var h=this;h.toolbar=this.el.find(".hc_image-tool");h.pageBtn=this.el.find(".hc_image-page");h.zoomBox=this.el.find(".hc_image-zoombox");h.maxImg=this.zoomBox.find(".hc_maxImg");h.image=this.el.find(".hc_miniimg");h.zoomBox.hide();h.toolbar.hide();h.pageBtn.hide();var g=this.el.attr("hwidth");var d=this.el.attr("hheight");this.el.width(g||200);this.el.height(d||200);this.image.width((g||200)-8);this.image.height((d||200)-8);this.pageBtn.css("margin-top",(d-this.pageBtn.height())/2+"px");h.initImages();function e(){h.toolbar.show();h.pageBtn.width(h.image.width()+8);h.pageBtn.show()}function i(k){h.pageBtn.hide();h.toolbar.hide()}h.image.hover(e,i);h.pageBtn.hover(e,i);h.toolbar.hover(e,i);h.image.click(function(){h.showZoomBox()});h.pageBtn.click(function(){h.showZoomBox()});h.zoomBox.find(".hc_image-zoomtool a").each(function(l,k){c(k).click(function(){h.rotate(l==0?"left":"right")})});h.zoomBox.find(".hc_image-zoomtool-close").each(function(l,k){c(k).click(function(){h.closeZomBox()})});h.pageBtn.find(".hc_image-pagepre").click(function(){h.prev();return false});h.pageBtn.find(".hc_image-pagenext").click(function(){h.next();return false});var f=c("<div class='h_floatdiv-backdrop'></div>").hide();c(document.body).append(f);this.backdrop=f;this.backdrop.click(function(){h.closeZoomBox()})},initImages:function(){var d=this;d.images=[];d.image.find("a").each(function(e,f){var h=c(f);if(e!=0){h.hide()}var g=h.children("img");h.height(d.image.height()-20);g.css("max-height",(d.image.height()-20)+"px");g.css("max-width",d.image.width()+"px");d.images.push(h)});d.totalPage=d.images.length;d.curPage=1;this.image.find(".hc_image-page-cur").text(this.images.length==0?0:1);this.image.find(".hc_image-page-count").text(this.images.length)},next:function(){var d=this.curPage;if(d==this.totalPage){d=1}else{d++}this.goPage(d)},prev:function(){var d=this.curPage;if(d==1){d=this.totalPage}else{d--}this.goPage(d)},goPage:function(e){var d=this;d.images[this.curPage-1].fadeOut("fast",function(){d.images[e-1].fadeIn("fast")});this.curPage=e;this.image.find(".hc_image-page-cur").text(e)},makeZoomBoxCenter:function(){var e=this.zoomBox;var g=c(window);var d=(g.width()-e.width())/2;var f=(g.height()-e.height())/2;d=g.scrollLeft()+(d);f=g.scrollTop()+(f);e.css("position","absolute").css("float","left").css("top",(g.height()-e.height())/2+g.scrollTop()+"px").css("left",(g.width()-e.width())/2+g.scrollLeft()+"px").css("z-index",100)},showZoomBox:function(e,l){var j=Horn.getComp(this.name+"win");j.show();var e=j.el.attr("h_width"),l=j.el.attr("h_height");var k=[];c(this.images).each(function(m,n){k.push(n.find("img").attr("src"))});c("#"+this.name+"winViewPic").remove();j.el.find(".h_floatdiv-con").append(c('<div id="'+this.name+'winViewPic"></div>'));var d="10.0.0";var i="playerProductInstall.swf";var f={};f.imagePaths=k.join(",").replace(/&/g,"#");var g={};g.quality="high";g.bgcolor="#ffffff";g.allowscriptaccess="sameDomain";g.allowfullscreen="true";var h={};h.id=this.name+"winViewPic";h.name=this.name+"winViewPic";h.align="middle";a.embedSWF(context_path+"/components/hc_extendcon/img/ViewPic.swf",this.name+"winViewPic",e-5,l-40,d,i,f,g,h);a.createCSS("#"+this.name+"winViewPic","display:block;text-align:left;")},closeZoomBox:function(d){this.zoomBox.hide();this.backdrop.hide()},setImages:function(d){c(this.images).each(function(f,g){g.remove()});var e=this;c(d).each(function(f,g){e.image.append('<a href="#" class="image-artzoom"><img src="'+g+'"/></a>')});this.initImages()}});c.extend(Horn.ImageBox,{boxWin:null,getImageBoxWin:function(d){d=d||{};if(!this.boxWin){Horn.getCurrent().append('<div id="__horn_image_win" class="h_floatdiv h_screen-content-3" name="__horn_image_win" h_height="'+(d.height||650)+'" h_width="'+(d.width||800)+'" style="display:none"><div class="h_floatdiv-title"><span>查看图片</span> <a href="#">X</a></div><div class="h_floatdiv-con"><div id="__horn_image_win"></div></div></div>');Horn.init();this.boxWin=Horn.getCompByEl(c("#__horn_image_win"));return this.boxWin}return this.boxWin},showImages:function(g){var l=g.title||"查看图片";var k=g.images||"";var j=this.getImageBoxWin(g);j.show();j.setTitle(l);var e=j.el.attr("h_width"),m=j.el.attr("h_height");c("#winViewPic").remove();j.el.find(".h_floatdiv-con").append(c('<div id="winViewPic"></div>'));var d="10.0.0";var i="playerProductInstall.swf";var f={};f.imagePaths=k.replace(/&/g,"#");var g={};g.quality="high";g.bgcolor="#ffffff";g.allowscriptaccess="sameDomain";g.allowfullscreen="true";var h={};h.id="winViewPic";h.name="winViewPic";h.align="middle";a.embedSWF(context_path+"/components/hc_extendcon/img/ViewPic.swf","winViewPic",e-5,m-40,d,i,f,g,h);a.createCSS("#winViewPic","display:block;text-align:left;")}});b.regUI("div.hc_image",b.ImageBox)})(Horn,jQuery);
Horn.SearchPanel=Horn.extend(Horn.Base,{COMPONENT_CLASS:"SearchPanel",field:null,btn:null,text:"请输入号码",init:function(){Horn.SearchPanel.superclass.init.apply(this,arguments);var b=this.el;var d=this.field=b.find("input:text");var a=this.btn=b.find("input:submit");var c=this;c.text=this.field.val();c.field.focus(function(){if(c.text==d.val()){d.val("")}d.addClass("h_search-txt-up");d.removeClass("h_search-txt")});c.field.blur(function(){if(""==d.val()){d.removeClass("h_search-txt-up");d.addClass("h_search-txt");d.val(c.text)}});setTimeout(function(){c.field.unbind("keydown")},100);a.click(function(){if(c.text==d.val()){d.val("")}})}});Horn.regUI("div.h_search",Horn.SearchPanel);
Horn.PageBar=Horn.extend(Horn.Base,{COMPONENT_CLASS:"PageBar",targetName:null,target:null,url:null,init:function(a){Horn.PageBar.superclass.init.apply(this,arguments);this.targetName=this.el.attr("target");this.url=this.el.attr("url");if(!this.url){this.url=window.location.href}this.initPageParams();this.initEvent()},initPageParams:function(){var a="";if(this.el.attr("bindformname")&&this.el.attr("bindformname").length>0){a=this.el.attr("bindformname")}var b=this.el;this.page=b.attr("pageNo")||this.page;this.pageSize=b.attr("pageSize")||this.pageSize;this.pageCount=b.attr("pageCount")||this.pageCount;this.pages=b.attr("pages")||this.pages;if(this.pageCount<=0||this.pages<=0){$("#"+a+"_topageid").attr("disabled","disabled");$("#"+a+"_topagesize").attr("disabled","disabled");$("#"+a+"_pagebtn-go").attr("disabled","disabled")}else{$("#"+a+"_topageid").removeAttr("disabled");$("#"+a+"_topagesize").removeAttr("disabled");$("#"+a+"_pagebtn-go").removeAttr("disabled")}},initEvent:function(){var b=this;var a="";if(this.el.attr("bindformname")&&this.el.attr("bindformname").length>0){a=this.el.attr("bindformname")}this.el.children("a").each(function(c,d){var f=$(d),e=function(h,i,g){h.click(function(){if(h.hasClass("h_page-dis")){return}if(h.hasClass("h_pagebtn-next")||h.hasClass("h_pagebtn-prev")){h.addClass("h_page-dis")}i.call(b,g)})};if(!f.hasClass("h_page-dis")){if(f.hasClass("h_pagebtn-index")){e(f,b.goPage,b.INDEX_PAGE)}else{if(f.hasClass("h_pagebtn-end")){e(f,b.goPage,parseInt(b.pages))}else{if(f.hasClass("h_pagebtn-next")){e(f,b.nextpage)}else{if(f.hasClass("h_pagebtn-prev")){e(f,b.prevpage)}else{if(f.hasClass("h_page-num")){e(f,b.goPage,parseInt(f.text()))}else{if(f.hasClass("h_pagebtn-go")){f.bind("click",function(i){var g=document.getElementById(a+"_topageid").value;var h=document.getElementById(a+"_topagesize").value;var j=[];j.push(parseInt(g),parseInt(h));return b.goPage.apply(b,j)})}}}}}}}})},getTarget:function(){return this.target||Horn.getComp(this.targetName)},INDEX_PAGE:1,page:1,pageSize:20,pageCount:0,pages:1,nextpage:function(){this.goPage(parseInt(this.page)+1)},prevpage:function(){this.goPage(parseInt(this.page)-1)},firstpage:function(){this.goPage(this.INDEX_PAGE)},goPage:function(c,b){var a="";if(this.el.attr("bindformname")&&this.el.attr("bindformname").length>0){a=this.el.attr("bindformname")}if(c<this.INDEX_PAGE){c=this.INDEX_PAGE}if(c>this.pages){c=this.pages}if(b>this.pageCount){b=this.pageCount}$("#"+a+"_topageid").val(c);if(b<0||b==null||b==undefined){b=this.pageSize}this.page=c;this.pageSize=b;this.doJump()},doJump:function(){if(this.el.attr("bindformname")&&this.el.attr("bindformname").length>0){var a=this.el.attr("bindformname");this.form=Horn.getCurrent().find("form[name='"+a+"']");var c='<input type="hidden" name="index" value="'+this.page+'"><input type="hidden" name="pageNo" value="'+this.page+'"><input type="hidden" name="pageSize" value="'+this.pageSize+'"><input type="hidden" name="count" value="'+this.pageCount+'"><input type="hidden" name="pages" value="'+this.pages+'">';this.form.append(c);this.form.attr("action",this.url);this.form.submit()}else{var b=this.url;function d(e,g){var f=new RegExp("([?|&])"+e+"=[^&]*");if(f.test(b)){b=b.replace(f,"$1"+e+"="+g)}else{b+=(b.indexOf("?")!=-1?"&":"?")+e+"="+g}}d("index",this.page);d("pageNo",this.page);d("pageSize",this.pageSize);d("count",this.pageCount);d("pages",this.pages);Horn.Util.jump(b)}}});Horn.regUI("div.h_pages",Horn.PageBar);
